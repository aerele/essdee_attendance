{"version":3,"file":"WorkflowActionSheet-tSPgpAX-.js","sources":["../../../../frontend/src/components/FilePreviewModal.vue","../../../../frontend/src/components/WorkflowActionSheet.vue"],"sourcesContent":["<template>\n\t<ion-header>\n\t\t<ion-toolbar>\n\t\t\t<ion-title>{{ filename }} - File Preview</ion-title>\n\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t<ion-button @click=\"modalController.dismiss()\">Close</ion-button>\n\t\t\t</ion-buttons>\n\t\t</ion-toolbar>\n\t</ion-header>\n\t<ion-content>\n\t\t<div class=\"bg-white h-full w-full overflow-auto touch-pinch-zoom\">\n\t\t\t<img v-if=\"isImageFile\" :src=\"src\" class=\"h-auto image-preview\" />\n\t\t\t<iframe v-else :src=\"src\" class=\"w-full h-full\"></iframe>\n\t\t</div>\n\t</ion-content>\n</template>\n\n<script setup>\nimport { computed, onBeforeUnmount } from \"vue\"\nimport {\n\tIonHeader,\n\tIonToolbar,\n\tIonContent,\n\tIonButtons,\n\tIonTitle,\n\tIonButton,\n\tmodalController,\n} from \"@ionic/vue\"\n\nconst props = defineProps({\n\tfile: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n})\n\nconst filename = computed(() => {\n\treturn props.file.file_name || props.file.name\n})\n\nconst src = computed(() => {\n\treturn props.file.file_url\n\t\t? props.file.file_url\n\t\t: URL.createObjectURL(props.file)\n})\n\nconst isImageFile = computed(() => {\n\treturn /\\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(filename.value)\n})\n\nonBeforeUnmount(() => {\n\tURL.revokeObjectURL(src.value)\n})\n</script>\n\n<style scoped>\n.image-preview {\n\timage-orientation: from-image;\n}\n</style>\n","<template>\n\t<div\n\t\tv-if=\"actions.length > 0\"\n\t\t:class=\"[\n\t\t\tprops.view === 'form'\n\t\t\t\t? 'px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg'\n\t\t\t\t: 'flex w-full flex-row items-center justify-between gap-3 sticky bottom-0 border-t z-[100] p-4',\n\t\t]\"\n\t>\n\t\t<Button\n\t\t\tv-if=\"props.view === 'form' || actions.length > 2\"\n\t\t\t@click=\"showTransitions()\"\n\t\t\tclass=\"w-full rounded py-5 text-base disabled:bg-gray-700 disabled:text-white\"\n\t\t\tvariant=\"solid\"\n\t\t>\n\t\t\t<template #prefix>\n\t\t\t\t<FeatherIcon name=\"chevron-up\" class=\"w-4\" />\n\t\t\t</template>\n\t\t\tActions\n\t\t</Button>\n\n\t\t<template v-else>\n\t\t\t<Button\n\t\t\t\tv-for=\"action in actions\"\n\t\t\t\tclass=\"w-full py-5\"\n\t\t\t\t:variant=\"action.variant\"\n\t\t\t\t:theme=\"action.theme\"\n\t\t\t\t@click=\"applyWorkflow({ workflowAction: action.text })\"\n\t\t\t>\n\t\t\t\t<template #prefix v-if=\"action.featherIcon\">\n\t\t\t\t\t<FeatherIcon :name=\"action.featherIcon\" class=\"w-4\" />\n\t\t\t\t</template>\n\t\t\t\t{{ action.text }}\n\t\t\t</Button>\n\t\t</template>\n\t</div>\n\n\t<ion-action-sheet\n\t\t:buttons=\"actions\"\n\t\t:is-open=\"showActionSheet\"\n\t\t@didDismiss=\"applyWorkflow({ event: $event })\"\n\t>\n\t</ion-action-sheet>\n</template>\n\n<script setup>\nimport { IonActionSheet, modalController } from \"@ionic/vue\"\nimport { computed, ref, onMounted } from \"vue\"\nimport { FeatherIcon } from \"frappe-ui\"\n\nconst props = defineProps({\n\tdoc: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\tworkflow: {\n\t\ttype: Object,\n\t\trequired: false,\n\t},\n\tview: {\n\t\ttype: String,\n\t\tdefault: \"form\",\n\t\tvalidator: (value) => [\"form\", \"actionSheet\"].includes(value),\n\t},\n})\n\nconst emit = defineEmits([\"workflow-applied\"])\n\nlet showActionSheet = ref(false)\nlet actions = ref([])\n\nconst getTransitions = async () => {\n\tconst transitions = await props.workflow.getTransitions(props.doc)\n\tactions.value = transitions.map((transition) => {\n\t\tlet role = \"\"\n\t\tlet theme = \"gray\"\n\t\tlet variant = \"subtle\"\n\t\tlet icon = \"\"\n\t\tlet actionLabel = transition.toLowerCase()\n\n\t\tif (actionLabel.includes(\"reject\") || actionLabel.includes(\"cancel\")) {\n\t\t\trole = \"destructive\"\n\t\t\ttheme = \"red\"\n\t\t\tvariant = \"subtle\"\n\t\t\ticon = \"x\"\n\t\t} else if (actionLabel.includes(\"approve\")) {\n\t\t\ttheme = \"green\"\n\t\t\tvariant = \"solid\"\n\t\t\ticon = \"check\"\n\t\t}\n\n\t\treturn {\n\t\t\ttext: transition,\n\t\t\trole: role,\n\t\t\ttheme: theme,\n\t\t\tvariant: variant,\n\t\t\tfeatherIcon: icon,\n\t\t\tdata: {\n\t\t\t\taction: transition,\n\t\t\t},\n\t\t}\n\t})\n}\n\nconst showTransitions = () => {\n\tif (actions.value?.length > 0) {\n\t\t// always add last action for dismissing the modal\n\t\tactions.value.push({\n\t\t\ttext: \"Dismiss\",\n\t\t\trole: \"cancel\",\n\t\t})\n\t}\n\n\tshowActionSheet.value = true\n}\n\nconst applyWorkflow = async ({ event = \"\", workflowAction = \"\" }) => {\n\tconst action = workflowAction || event.detail.data?.action\n\tif (action) {\n\t\tawait props.workflow.applyWorkflow(props.doc, action)\n\t\tmodalController.dismiss()\n\t\temit(\"workflow-applied\")\n\t}\n\n\tshowActionSheet.value = false\n}\n\nonMounted(() => getTransitions())\n</script>\n\n<style scoped>\nion-action-sheet {\n\t--button-color: var(--text-gray-500);\n}\n</style>\n"],"names":["props","__props","filename","computed","src","isImageFile","onBeforeUnmount","emit","__emit","showActionSheet","ref","actions","getTransitions","__async","transitions","transition","role","theme","variant","icon","actionLabel","showTransitions","_a","applyWorkflow","_0","event","workflowAction","action","modalController","onMounted"],"mappings":"0oBA6BA,MAAMA,EAAQC,EAORC,EAAWC,EAAS,IAClBH,EAAM,KAAK,WAAaA,EAAM,KAAK,IAC1C,EAEKI,EAAMD,EAAS,IACbH,EAAM,KAAK,SACfA,EAAM,KAAK,SACX,IAAI,gBAAgBA,EAAM,IAAI,CACjC,EAEKK,EAAcF,EAAS,IACrB,kCAAkC,KAAKD,EAAS,KAAK,CAC5D,EAED,OAAAI,EAAgB,IAAM,CACrB,IAAI,gBAAgBF,EAAI,KAAK,CAC9B,CAAC,62BCFD,MAAMJ,EAAQC,EAgBRM,EAAOC,EAEb,IAAIC,EAAkBC,EAAI,EAAK,EAC3BC,EAAUD,EAAI,EAAE,EAEpB,MAAME,EAAiB,IAAYC,EAAA,sBAClC,MAAMC,EAAc,MAAMd,EAAM,SAAS,eAAeA,EAAM,GAAG,EACjEW,EAAQ,MAAQG,EAAY,IAAKC,GAAe,CAC/C,IAAIC,EAAO,GACPC,EAAQ,OACRC,EAAU,SACVC,EAAO,GACPC,EAAcL,EAAW,YAAa,EAE1C,OAAIK,EAAY,SAAS,QAAQ,GAAKA,EAAY,SAAS,QAAQ,GAClEJ,EAAO,cACPC,EAAQ,MACRC,EAAU,SACVC,EAAO,KACGC,EAAY,SAAS,SAAS,IACxCH,EAAQ,QACRC,EAAU,QACVC,EAAO,SAGD,CACN,KAAMJ,EACN,KAAMC,EACN,MAAOC,EACP,QAASC,EACT,YAAaC,EACb,KAAM,CACL,OAAQJ,CACR,CACD,CACH,CAAE,CACF,GAEMM,EAAkB,IAAM,SACzBC,EAAAX,EAAQ,QAAR,YAAAW,EAAe,QAAS,GAE3BX,EAAQ,MAAM,KAAK,CAClB,KAAM,UACN,KAAM,QACT,CAAG,EAGFF,EAAgB,MAAQ,EACzB,EAEMc,EAAuBC,GAAwCX,EAAA,MAAxCW,GAAwC,UAAxC,CAAE,MAAAC,EAAQ,GAAI,eAAAC,EAAiB,EAAE,EAAO,OACpE,MAAMC,EAASD,KAAkBJ,EAAAG,EAAM,OAAO,OAAb,YAAAH,EAAmB,QAChDK,IACH,MAAM3B,EAAM,SAAS,cAAcA,EAAM,IAAK2B,CAAM,EACpDC,EAAgB,QAAS,EACzBrB,EAAK,kBAAkB,GAGxBE,EAAgB,MAAQ,EACzB,GAEA,OAAAoB,EAAU,IAAMjB,EAAc,CAAE"}
var te=Object.defineProperty,oe=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var D=(s,e,l)=>e in s?te(s,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[e]=l,E=(s,e)=>{for(var l in e||(e={}))le.call(e,l)&&D(s,l,e[l]);if(A)for(var l of A(e))ae.call(e,l)&&D(s,l,e[l]);return s},L=(s,e)=>oe(s,se(e));var H=(s,e,l)=>new Promise((V,C)=>{var F=n=>{try{p(l.next(n))}catch(u){C(u)}},m=n=>{try{p(l.throw(n))}catch(u){C(u)}},p=n=>n.done?V(n.value):Promise.resolve(n.value).then(F,m);p((l=l.apply(s,e)).next())});import{a1 as re,a2 as ne,i as P,Q as ie,a as w,c as R,O as ue,w as ce,e as de,f as T,j as h,k as x,l as a,n as f,x as b,q as r,t as U,K as fe,I as me,v as pe,F as z,H as ve,y as J,J as ye,a5 as M,aj as ge,al as we}from"./frappe-ui-DZDZpt4w.js";import{a as he,H as be,J as _e,b as ke,m as O}from"./index-BxNz1Obz.js";import xe from"./TabButtons-BKrC3lFY.js";import Ce from"./PermissionRequestItem-LV5az5ig.js";import Fe from"./ListFiltersActionSheet-CICp4Pdf.js";import Se from"./CustomIonModal-5G33LXxg.js";import{u as Be}from"./workflow-CgWnsJgA.js";import{u as Re}from"./realtime-BMya6vLA.js";import"./EmployeeAvatar-zMm99X4x.js";import"./permissions-DOYaNnKb.js";import"./FormField-7rSNy-En.js";import"./Link-WtJjedfJ.js";const Ve={class:"w-full sm:w-96"},$e={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},qe={class:"flex flex-row items-center"},Te={class:"text-xl font-semibold text-gray-900"},Ie={class:"flex flex-row gap-2"},je={class:"w-full mt-5"},Ne={key:0,class:"flex flex-col bg-white rounded mt-5"},Ae={key:2,class:"flex mt-2 items-center justify-center"},Ge={__name:"PermissionListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!0},pageTitle:{type:String,required:!0}},setup(s){const e=s,l={"Essdee Permission Application":re(Ce)},V=ne(),C=P("$socket"),F=P("$employee"),m=ie({}),p=w(e.tabButtons[0]),n=w(!1),u=w([]),S=w(null),I=w(null),$=w(!0),B=w({doctype:e.doctype,fields:e.fields,group_by:e.groupBy,order_by:`\`tab${e.doctype}\`.modified desc`,page_length:50}),j=R(()=>p.value===e.tabButtons[1]),W=R(()=>`${e.doctype.replace(/\s+/g,"")}FormView`),K=R(()=>`${e.doctype.replace(/\s+/g,"")}DetailView`),Q=R(()=>{const t=[];return j.value?t.push([e.doctype,"employee","!=",F.data.name]):t.push([e.doctype,"employee","=",F.data.name]),t}),c=ue({url:"frappe.desk.reportview.get",onSuccess:t=>{var o;((o=t.values)==null?void 0:o.length)<B.value.page_length&&($.value=!1)},transform(t){if(t.length===0)return[];const o=t.keys,_=t.values.map(g=>{const k={};return o.forEach((i,q)=>{k[i]=g[q]}),k});let y;return!c.params.start||c.params.start===0?y=_:y=c.data.concat(_),y}});function N(){e.filterConfig.forEach(t=>{m[t.fieldname]={condition:"=",value:null}}),u.value=[]}N();function G(){let t="",o="";u.value=[];for(const d in m)t=m[d].condition,typeof t=="object"&&t!==null&&(t=t.value),o=m[d].value,t&&o&&u.value.push([e.doctype,d,t,o])}function X(){G(),v(),O.dismiss(),n.value=!!u.value.length}function Y(){N(),v(),O.dismiss(),n.value=!1}function v(t=0){t===0&&($.value=!0);const o=[[e.doctype,"docstatus","!=","2"]];o.push(...Q.value),u.value&&o.push(...u.value),S.value&&B.value.fields.push(S.value),c.submit(L(E({},B.value),{start:t||0,filters:o}))}const Z=we(()=>{if(!$.value)return;const{scrollTop:t,scrollHeight:o,clientHeight:d}=I.value;if(t/(o-d)*100>=90){const y=c.params.start+B.value.page_length;v(y)}},500),ee=t=>{setTimeout(()=>{v(),t.target.complete()},500)};return ce(()=>p.value,t=>{v()}),de(()=>H(this,null,function*(){const t=Be(e.doctype);yield t.workflowDoc.promise,S.value=t.getWorkflowStateField(),v(),Re(C,e.doctype,()=>v())})),(t,o)=>{const d=T("Button"),_=T("router-link"),y=T("EmptyState");return h(),x(z,null,[a(r(he),{class:"ion-no-border"},{default:f(()=>[b("div",Ve,[b("div",$e,[b("div",qe,[a(d,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:o[0]||(o[0]=g=>r(V).back())},{default:f(()=>[a(r(U),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),b("h2",Te,fe(s.pageTitle),1)]),b("div",Ie,[a(d,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:me([n.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),a(_,{to:{name:W.value}},{default:f(({navigate:g})=>[a(d,{variant:"solid",class:"mr-2",onClick:g},{prefix:f(()=>[a(r(U),{name:"plus",class:"w-4"})]),default:f(()=>[pe(" New ")]),_:2},1032,["onClick"])]),_:1},8,["to"])])])])]),_:1}),a(r(ke),null,{default:f(()=>{var g,k;return[a(r(be),{slot:"fixed",onIonRefresh:o[1]||(o[1]=i=>ee(i))},{default:f(()=>[a(r(_e))]),_:1}),b("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:I,onScroll:o[3]||(o[3]=()=>r(Z)())},[b("div",je,[a(xe,{buttons:[{label:s.tabButtons[0]},{label:s.tabButtons[1]}],modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=i=>p.value=i)},null,8,["buttons","modelValue"]),!r(c).loading&&((g=r(c).data)!=null&&g.length)?(h(),x("div",Ne,[(h(!0),x(z,null,ve(r(c).data,i=>(h(),x("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:i.name},[a(_,{to:{name:K.value,params:{id:i.name}}},{default:f(({navigate:q})=>[(h(),J(ye(l[s.doctype]),{doc:i,isTeamRequest:j.value,workflowStateField:S.value,onClick:q},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"])]))),128))])):r(c).loading?M("",!0):(h(),J(y,{key:1,message:`No ${(k=e.doctype)==null?void 0:k.toLowerCase()}s found`},null,8,["message"])),r(c).loading?(h(),x("div",Ae,[a(r(ge),{class:"w-8 h-8 text-gray-800"})])):M("",!0)])],544),a(Se,{trigger:"show-filter-modal"},{actionSheet:f(()=>[a(Fe,{filterConfig:s.filterConfig,onApplyFilters:X,onClearFilters:Y,filters:m,"onUpdate:filters":o[4]||(o[4]=i=>m=i)},null,8,["filterConfig","filters"])]),_:1})]}),_:1})],64)}}};export{Ge as default};
//# sourceMappingURL=PermissionListView-CURh9xDq.js.map

var oe=Object.defineProperty,se=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var N=(s,e,l)=>e in s?oe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[e]=l,D=(s,e)=>{for(var l in e||(e={}))ae.call(e,l)&&N(s,l,e[l]);if(L)for(var l of L(e))re.call(e,l)&&N(s,l,e[l]);return s},H=(s,e)=>se(s,le(e));var P=(s,e,l)=>new Promise((R,C)=>{var F=n=>{try{p(l.next(n))}catch(u){C(u)}},m=n=>{try{p(l.throw(n))}catch(u){C(u)}},p=n=>n.done?R(n.value):Promise.resolve(n.value).then(F,m);p((l=l.apply(s,e)).next())});import{a1 as T,a2 as ne,i as U,Q as ie,a as w,c as B,O as ue,w as ce,e as fe,f as I,j as h,k as x,l as a,n as d,x as _,q as r,t as z,K as de,I as me,v as pe,F as J,H as ve,y as M,J as ye,a5 as O,aj as ge,al as we}from"./frappe-ui-DZDZpt4w.js";import{a as he,H as _e,J as be,b as ke,m as W}from"./index-DY6of2et.js";import xe from"./TabButtons-BKrC3lFY.js";import Ce from"./LeaveRequestItem-De6y222G.js";import Fe from"./ExpenseClaimItem-CZZ6gXGV.js";import Se from"./EmployeeAdvanceItem-7j1smnBm.js";import $e from"./ListFiltersActionSheet-CICp4Pdf.js";import Be from"./CustomIonModal-BGmNRiHp.js";import{u as Re}from"./workflow-VIVVb1p-.js";import{u as Ve}from"./realtime-BMya6vLA.js";import"./EmployeeAvatar-BxuleOmI.js";import"./leaves-YLIW9pOG.js";import"./currencies-SJR35BQj.js";import"./formatters-Ch330Bw1.js";import"./FormField-7rSNy-En.js";import"./Link-WtJjedfJ.js";const qe={class:"w-full sm:w-96"},Te={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},Ie={class:"flex flex-row items-center"},je={class:"text-xl font-semibold text-gray-900"},Ae={class:"flex flex-row gap-2"},Ee={class:"w-full mt-5"},Le={key:0,class:"flex flex-col bg-white rounded mt-5"},Ne={key:2,class:"flex mt-2 items-center justify-center"},ot={__name:"ListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!0},pageTitle:{type:String,required:!0}},setup(s){const e=s,l={"Leave Application":T(Ce),"Expense Claim":T(Fe),"Employee Advance":T(Se)},R=ne(),C=U("$socket"),F=U("$employee"),m=ie({}),p=w(e.tabButtons[0]),n=w(!1),u=w([]),S=w(null),j=w(null),V=w(!0),$=w({doctype:e.doctype,fields:e.fields,group_by:e.groupBy,order_by:`\`tab${e.doctype}\`.modified desc`,page_length:50}),A=B(()=>p.value===e.tabButtons[1]),K=B(()=>`${e.doctype.replace(/\s+/g,"")}FormView`),Q=B(()=>`${e.doctype.replace(/\s+/g,"")}DetailView`),G=B(()=>{const t=[];return A.value?t.push([e.doctype,"employee","!=",F.data.name]):t.push([e.doctype,"employee","=",F.data.name]),t}),c=ue({url:"frappe.desk.reportview.get",onSuccess:t=>{var o;((o=t.values)==null?void 0:o.length)<$.value.page_length&&(V.value=!1)},transform(t){if(t.length===0)return[];const o=t.keys,b=t.values.map(g=>{const k={};return o.forEach((i,q)=>{k[i]=g[q]}),k});let y;return!c.params.start||c.params.start===0?y=b:y=c.data.concat(b),y}});function E(){e.filterConfig.forEach(t=>{m[t.fieldname]={condition:"=",value:null}}),u.value=[]}E();function X(){let t="",o="";u.value=[];for(const f in m)t=m[f].condition,typeof t=="object"&&t!==null&&(t=t.value),o=m[f].value,t&&o&&u.value.push([e.doctype,f,t,o])}function Y(){X(),v(),W.dismiss(),n.value=!!u.value.length}function Z(){E(),v(),W.dismiss(),n.value=!1}function v(t=0){t===0&&(V.value=!0);const o=[[e.doctype,"docstatus","!=","2"]];o.push(...G.value),u.value&&o.push(...u.value),S.value&&$.value.fields.push(S.value),c.submit(H(D({},$.value),{start:t||0,filters:o}))}const ee=we(()=>{if(!V.value)return;const{scrollTop:t,scrollHeight:o,clientHeight:f}=j.value;if(t/(o-f)*100>=90){const y=c.params.start+$.value.page_length;v(y)}},500),te=t=>{setTimeout(()=>{v(),t.target.complete()},500)};return ce(()=>p.value,t=>{v()}),fe(()=>P(this,null,function*(){const t=Re(e.doctype);yield t.workflowDoc.promise,S.value=t.getWorkflowStateField(),v(),Ve(C,e.doctype,()=>v())})),(t,o)=>{const f=I("Button"),b=I("router-link"),y=I("EmptyState");return h(),x(J,null,[a(r(he),{class:"ion-no-border"},{default:d(()=>[_("div",qe,[_("div",Te,[_("div",Ie,[a(f,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:o[0]||(o[0]=g=>r(R).back())},{default:d(()=>[a(r(z),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),_("h2",je,de(s.pageTitle),1)]),_("div",Ae,[a(f,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:me([n.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),a(b,{to:{name:K.value}},{default:d(({navigate:g})=>[a(f,{variant:"solid",class:"mr-2",onClick:g},{prefix:d(()=>[a(r(z),{name:"plus",class:"w-4"})]),default:d(()=>[pe(" New ")]),_:2},1032,["onClick"])]),_:1},8,["to"])])])])]),_:1}),a(r(ke),null,{default:d(()=>{var g,k;return[a(r(_e),{slot:"fixed",onIonRefresh:o[1]||(o[1]=i=>te(i))},{default:d(()=>[a(r(be))]),_:1}),_("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:j,onScroll:o[3]||(o[3]=()=>r(ee)())},[_("div",Ee,[a(xe,{buttons:[{label:s.tabButtons[0]},{label:s.tabButtons[1]}],modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=i=>p.value=i)},null,8,["buttons","modelValue"]),!r(c).loading&&((g=r(c).data)!=null&&g.length)?(h(),x("div",Le,[(h(!0),x(J,null,ve(r(c).data,i=>(h(),x("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:i.name},[a(b,{to:{name:Q.value,params:{id:i.name}}},{default:d(({navigate:q})=>[(h(),M(ye(l[s.doctype]),{doc:i,isTeamRequest:A.value,workflowStateField:S.value,onClick:q},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"])]))),128))])):r(c).loading?O("",!0):(h(),M(y,{key:1,message:`No ${(k=e.doctype)==null?void 0:k.toLowerCase()}s found`},null,8,["message"])),r(c).loading?(h(),x("div",Ne,[a(r(ge),{class:"w-8 h-8 text-gray-800"})])):O("",!0)])],544),a(Be,{trigger:"show-filter-modal"},{actionSheet:d(()=>[a($e,{filterConfig:s.filterConfig,onApplyFilters:Y,onClearFilters:Z,filters:m,"onUpdate:filters":o[4]||(o[4]=i=>m=i)},null,8,["filterConfig","filters"])]),_:1})]}),_:1})],64)}}};export{ot as default};
//# sourceMappingURL=ListView-B3FopGP1.js.map

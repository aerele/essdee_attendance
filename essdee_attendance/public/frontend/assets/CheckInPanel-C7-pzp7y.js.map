{"version":3,"file":"CheckInPanel-C7-pzp7y.js","sources":["../../../../frontend/src/components/CheckInPanel.vue"],"sourcesContent":["<template>\n\t<div class=\"flex flex-col bg-white rounded w-full py-6 px-4 border-none\">\n\t\t<h2 class=\"text-lg font-bold text-gray-900\">Hey, {{ employee?.data?.first_name }} ðŸ‘‹</h2>\n\n\t\t<template v-if=\"settings.data?.allow_employee_checkin_from_mobile_app\">\n\t\t\t<div class=\"font-medium text-sm text-gray-500 mt-1.5\" v-if=\"lastLog\">\n\t\t\t\tLast {{ lastLogType }} was at {{ lastLogTime }}\n\t\t\t</div>\n\t\t\t<!-- <Button\n\t\t\t\tclass=\"mt-4 mb-1 drop-shadow-sm py-5 text-base\"\n\t\t\t\tid=\"open-checkin-modal\"\n\t\t\t\t@click=\"handleEmployeeCheckin\"\n\t\t\t>\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t:name=\"nextAction.action === 'IN' ? 'arrow-right-circle' : 'arrow-left-circle'\"\n\t\t\t\t\t\tclass=\"w-4\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t{{ nextAction.label }}\n\t\t\t</Button> -->\n\t\t</template>\n\n\t\t<div v-else class=\"font-medium text-sm text-gray-500 mt-1.5\">\n\t\t\t{{ dayjs().format(\"ddd, D MMMM, YYYY\") }}\n\t\t</div>\n\t</div>\n\n\t<ion-modal\n\t\tv-if=\"settings.data?.allow_employee_checkin_from_mobile_app\"\n\t\tref=\"modal\"\n\t\ttrigger=\"open-checkin-modal\"\n\t\t:initial-breakpoint=\"1\"\n\t\t:breakpoints=\"[0, 1]\"\n\t>\n\t\t<div class=\"h-120 w-full flex flex-col items-center justify-center gap-5 p-4 mb-5\">\n\t\t\t<div class=\"flex flex-col gap-1.5 mt-2 items-center justify-center\">\n\t\t\t\t<div class=\"font-bold text-xl\">\n\t\t\t\t\t{{ dayjs(checkinTimestamp).format(\"hh:mm:ss a\") }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"font-medium text-gray-500 text-sm\">\n\t\t\t\t\t{{ dayjs().format(\"D MMM, YYYY\") }}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<template v-if=\"settings.data?.allow_geolocation_tracking\">\n\t\t\t\t<span v-if=\"locationStatus\" class=\"font-medium text-gray-500 text-sm\">\n\t\t\t\t\t{{ locationStatus }}\n\t\t\t\t</span>\n\n\t\t\t\t<div class=\"rounded border-4 translate-z-0 block overflow-hidden w-full h-170\">\n\t\t\t\t\t<iframe\n\t\t\t\t\t\twidth=\"100%\"\n\t\t\t\t\t\theight=\"170\"\n\t\t\t\t\t\tframeborder=\"0\"\n\t\t\t\t\t\tscrolling=\"no\"\n\t\t\t\t\t\tmarginheight=\"0\"\n\t\t\t\t\t\tmarginwidth=\"0\"\n\t\t\t\t\t\tstyle=\"border: 0\"\n\t\t\t\t\t\t:src=\"`https://maps.google.com/maps?q=${latitude},${longitude}&hl=en&z=15&amp;output=embed`\"\n\t\t\t\t\t>\n\t\t\t\t\t</iframe>\n\t\t\t\t</div>\n\t\t\t</template>\n\n\t\t\t<Button variant=\"solid\" class=\"w-full py-5 text-sm\" @click=\"submitLog(nextAction.action)\">\n\t\t\t\tConfirm {{ nextAction.label }}\n\t\t\t</Button>\n\t\t</div>\n\t</ion-modal>\n</template>\n\n<script setup>\nimport { createResource, createListResource, toast, FeatherIcon } from \"frappe-ui\"\nimport { computed, inject, ref, onMounted, onBeforeUnmount } from \"vue\"\nimport { IonModal, modalController } from \"@ionic/vue\"\n\nconst DOCTYPE = \"Employee Checkin\"\n\nconst socket = inject(\"$socket\")\nconst employee = inject(\"$employee\")\nconst dayjs = inject(\"$dayjs\")\nconst checkinTimestamp = ref(null)\nconst latitude = ref(0)\nconst longitude = ref(0)\nconst locationStatus = ref(\"\")\n\nconst settings = createResource({\n\turl: \"essdee_attendance.api.get_hr_settings\",\n\tauto: true,\n})\n\nconst checkins = createListResource({\n\tdoctype: DOCTYPE,\n\tfields: [\"name\", \"employee\", \"employee_name\", \"log_type\", \"time\", \"device_id\"],\n\tfilters: {\n\t\temployee: employee.data.name,\n\t},\n\torderBy: \"time desc\",\n})\ncheckins.reload()\n\nconst lastLog = computed(() => {\n\tif (checkins.list.loading || !checkins.data) return {}\n\treturn checkins.data[0]\n})\n\nconst lastLogType = computed(() => {\n\treturn lastLog?.value?.log_type === \"IN\" ? \"check-in\" : \"check-out\"\n})\n\nconst nextAction = computed(() => {\n\treturn lastLog?.value?.log_type === \"IN\"\n\t\t? { action: \"OUT\", label: \"Check Out\" }\n\t\t: { action: \"IN\", label: \"Check In\" }\n})\n\nconst lastLogTime = computed(() => {\n\tconst timestamp = lastLog?.value?.time\n\tconst formattedTime = dayjs(timestamp).format(\"hh:mm a\")\n\n\tif (dayjs(timestamp).isToday()) return formattedTime\n\telse if (dayjs(timestamp).isYesterday()) return `${formattedTime} yesterday`\n\telse if (dayjs(timestamp).isSame(dayjs(), \"year\"))\n\t\treturn `${formattedTime} on ${dayjs(timestamp).format(\"D MMM\")}`\n\n\treturn `${formattedTime} on ${dayjs(timestamp).format(\"D MMM, YYYY\")}`\n})\n\nfunction handleLocationSuccess(position) {\n\tlatitude.value = position.coords.latitude\n\tlongitude.value = position.coords.longitude\n\n\tlocationStatus.value = `\n\t\tLatitude: ${Number(latitude.value).toFixed(5)}Â°,\n\t\tLongitude: ${Number(longitude.value).toFixed(5)}Â°\n\t`\n}\n\nfunction handleLocationError(error) {\n\tlocationStatus.value = \"Unable to retrieve your location\"\n\tif (error) locationStatus.value += `: ERROR(${error.code}): ${error.message}`\n}\n\nconst fetchLocation = () => {\n\tif (!navigator.geolocation) {\n\t\tlocationStatus.value = \"Geolocation is not supported by your current browser\"\n\t} else {\n\t\tlocationStatus.value = \"Locating...\"\n\t\tnavigator.geolocation.getCurrentPosition(handleLocationSuccess, handleLocationError)\n\t}\n}\n\nconst handleEmployeeCheckin = () => {\n\tcheckinTimestamp.value = dayjs().format(\"YYYY-MM-DD HH:mm:ss\")\n\n\tif (settings.data?.allow_geolocation_tracking) {\n\t\tfetchLocation()\n\t}\n}\n\nconst submitLog = (logType) => {\n\tconst action = logType === \"IN\" ? \"Check-in\" : \"Check-out\"\n\n\tcheckins.insert.submit(\n\t\t{\n\t\t\temployee: employee.data.name,\n\t\t\tlog_type: logType,\n\t\t\ttime: checkinTimestamp.value,\n\t\t\tlatitude: latitude.value,\n\t\t\tlongitude: longitude.value,\n\t\t},\n\t\t{\n\t\t\tonSuccess() {\n\t\t\t\tmodalController.dismiss()\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: \"Success\",\n\t\t\t\t\ttext: `${action} successful!`,\n\t\t\t\t\ticon: \"check-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-green-500\",\n\t\t\t\t})\n\t\t\t},\n\t\t\tonError() {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: \"Error\",\n\t\t\t\t\ttext: `${action} failed!`,\n\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t})\n\t\t\t},\n\t\t}\n\t)\n}\n\nonMounted(() => {\n\tsocket.emit(\"doctype_subscribe\", DOCTYPE)\n\tsocket.on(\"list_update\", (data) => {\n\t\tif (data.doctype == DOCTYPE) {\n\t\t\tcheckins.reload()\n\t\t}\n\t})\n})\n\nonBeforeUnmount(() => {\n\tsocket.emit(\"doctype_unsubscribe\", DOCTYPE)\n\tsocket.off(\"list_update\")\n})\n</script>\n"],"names":["DOCTYPE","socket","inject","employee","dayjs","checkinTimestamp","ref","latitude","longitude","locationStatus","settings","createResource","checkins","createListResource","lastLog","computed","lastLogType","_a","nextAction","lastLogTime","timestamp","formattedTime","submitLog","logType","action","modalController","toast","onMounted","data","onBeforeUnmount"],"mappings":"m0BA6EMA,EAAU,uDAEhB,MAAMC,EAASC,EAAO,SAAS,EACzBC,EAAWD,EAAO,WAAW,EAC7BE,EAAQF,EAAO,QAAQ,EACvBG,EAAmBC,EAAI,IAAI,EAC3BC,EAAWD,EAAI,CAAC,EAChBE,EAAYF,EAAI,CAAC,EACjBG,EAAiBH,EAAI,EAAE,EAEvBI,EAAWC,EAAe,CAC/B,IAAK,wCACL,KAAM,EACP,CAAC,EAEKC,EAAWC,EAAmB,CACnC,QAASb,EACT,OAAQ,CAAC,OAAQ,WAAY,gBAAiB,WAAY,OAAQ,WAAW,EAC7E,QAAS,CACR,SAAUG,EAAS,KAAK,IACxB,EACD,QAAS,WACV,CAAC,EACDS,EAAS,OAAQ,EAEjB,MAAME,EAAUC,EAAS,IACpBH,EAAS,KAAK,SAAW,CAACA,EAAS,KAAa,CAAE,EAC/CA,EAAS,KAAK,CAAC,CACtB,EAEKI,EAAcD,EAAS,IAAM,OAClC,QAAOE,EAAAH,GAAA,YAAAA,EAAS,QAAT,YAAAG,EAAgB,YAAa,KAAO,WAAa,WACzD,CAAC,EAEKC,EAAaH,EAAS,IAAM,OACjC,QAAOE,EAAAH,GAAA,YAAAA,EAAS,QAAT,YAAAG,EAAgB,YAAa,KACjC,CAAE,OAAQ,MAAO,MAAO,WAAa,EACrC,CAAE,OAAQ,KAAM,MAAO,UAAY,CACvC,CAAC,EAEKE,EAAcJ,EAAS,IAAM,OAClC,MAAMK,GAAYH,EAAAH,GAAA,YAAAA,EAAS,QAAT,YAAAG,EAAgB,KAC5BI,EAAgBjB,EAAMgB,CAAS,EAAE,OAAO,SAAS,EAEvD,OAAIhB,EAAMgB,CAAS,EAAE,QAAO,EAAWC,EAC9BjB,EAAMgB,CAAS,EAAE,YAAa,EAAS,GAAGC,CAAa,aACvDjB,EAAMgB,CAAS,EAAE,OAAOhB,EAAK,EAAI,MAAM,EACxC,GAAGiB,CAAa,OAAOjB,EAAMgB,CAAS,EAAE,OAAO,OAAO,CAAC,GAExD,GAAGC,CAAa,OAAOjB,EAAMgB,CAAS,EAAE,OAAO,aAAa,CAAC,EACrE,CAAC,EAkCKE,EAAaC,GAAY,CAC9B,MAAMC,EAASD,IAAY,KAAO,WAAa,YAE/CX,EAAS,OAAO,OACf,CACC,SAAUT,EAAS,KAAK,KACxB,SAAUoB,EACV,KAAMlB,EAAiB,MACvB,SAAUE,EAAS,MACnB,UAAWC,EAAU,KACrB,EACD,CACC,WAAY,CACXiB,EAAgB,QAAS,EACzBC,EAAM,CACL,MAAO,UACP,KAAM,GAAGF,CAAM,eACf,KAAM,eACN,SAAU,gBACV,YAAa,gBAClB,CAAK,CACD,EACD,SAAU,CACTE,EAAM,CACL,MAAO,QACP,KAAM,GAAGF,CAAM,WACf,KAAM,eACN,SAAU,gBACV,YAAa,cAClB,CAAK,CACD,CACD,CACD,CACF,EAEA,OAAAG,EAAU,IAAM,CACf1B,EAAO,KAAK,oBAAqBD,CAAO,EACxCC,EAAO,GAAG,cAAgB2B,GAAS,CAC9BA,EAAK,SAAW5B,GACnBY,EAAS,OAAQ,CAEpB,CAAE,CACF,CAAC,EAEDiB,EAAgB,IAAM,CACrB5B,EAAO,KAAK,sBAAuBD,CAAO,EAC1CC,EAAO,IAAI,aAAa,CACzB,CAAC"}
{"version":3,"file":"Form-DVL_nkE0.js","sources":["../../../../frontend/src/views/permission/Form.vue"],"sourcesContent":["<template>\n\t<ion-page>\n\t\t<ion-content :fullscreen=\"true\">\n\t\t\t<FormView\n\t\t\t\tv-if=\"formFields.data\"\n\t\t\t\tdoctype=\"Essdee Permission Application\"\n\t\t\t\tv-model=\"essdeePermissionApplication\"\n\t\t\t\t:isSubmittable=\"true\"\n\t\t\t\t:fields=\"formFields.data\"\n\t\t\t\t:id=\"props.id\"\n\t\t\t\t:showAttachmentView=\"true\"\n\t\t\t\t@validateForm=\"validateForm\"\n\t\t\t/>\n\t\t</ion-content>\n\t</ion-page>\n</template>\n\n<script setup>\nimport { IonPage, IonContent } from \"@ionic/vue\"\nimport { createResource } from \"frappe-ui\"\nimport { ref, watch, inject } from \"vue\"\n\nimport FormView from \"@/components/FormView.vue\"\n\nconst dayjs = inject(\"$dayjs\")\nconst employee = inject(\"$employee\")\nconst today = dayjs().format(\"YYYY-MM-DD\")\n\nconst props = defineProps({\n\tid: {\n\t\ttype: String,\n\t\trequired: false,\n\t},\n})\n\n// reactive object to store form data\nconst essdeePermissionApplication = ref({})\n\n// get form fields\nconst formFields = createResource({\n\turl: \"essdee_attendance.api.get_doctype_fields\",\n\tparams: { doctype: \"Essdee Permission Application\" },\n\ttransform(data) {\n\t\tlet fields = getFilteredFields(data)\n\n\t\treturn fields.map((field) => {\n\t\t\tif (field.fieldname === \"posting_date\") field.default = today\n\t\t\treturn field\n\t\t})\n\t},\n\tonSuccess(_data) {\n\t\tpermissionApprovalDetails.reload()\n\t},\n})\nformFields.reload()\n\nlet field_list = {}\nlet hide_fields = ['end_time','end_date']\n\nconst permissionApprovalDetails = createResource({\n\turl: \"essdee_attendance.api.get_permission_approval_details\",\n\tparams: { employee: employee.data.name },\n\tonSuccess(data) {\n\t\tsetPermissionApprovers(data)\n\t},\n})\n\n// form scripts\nwatch(\n\t() => essdeePermissionApplication.value.employee,\n\t(employee_id) => {\n\t\tif (props.id && employee_id !== employee.data.name) {\n\t\t\tsetFormReadOnly()\n\t\t}\n\t}\n)\n\nwatch(\n\t() => [essdeePermissionApplication.value.permission_type, essdeePermissionApplication.value],\n\t([permission_type, essdeePermissionApplication]) => {\n\t\tif(permission_type == 'Personal Permission' && essdeePermissionApplication.docstatus != 0){\n\t\t\tfor(let i = 0; i< hide_fields.length ; i++){\n\t\t\t\tfor(let j = 0 ; j < formFields.data.length ; j++){\n\t\t\t\t\tif(hide_fields.includes(formFields.data[j]['fieldname'])){\n\t\t\t\t\t\tlet temp = formFields.data\n\t\t\t\t\t\tif(j == formFields.data.length - 1){\n\t\t\t\t\t\t\tformFields.data = temp.slice(0,formFields.data.length - 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tformFields.data = temp.slice(0,j).concat(temp.slice(j+1,formFields.data.length))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tformFields.reload()\n\t\t}\n\t}\n)\n\nwatch(\n\t() => [essdeePermissionApplication.value.start_time,essdeePermissionApplication.value.end_time],\n\t([start_time, end_time]) => {\n\t\tvalidateDates(start_time, end_time)\n\t}\n)\n\n// helper functions\nfunction getFilteredFields(fields) {\n\t// reduce noise from the form view by excluding unnecessary fields\n\t// ex: employee and other details can be fetched from the session user\n\tconst excludeFields = [\n\t\t\"naming_series\",\n\t\t\"sb_other_details\",\n\t\t\"salary_slip\",\n\t\t\"letter_head\",\n\t]\n\n\tconst employeeFields = [\n\t\t\"employee\",\n\t\t\"employee_name\",\n\t\t\"department\",\n\t\t\"designation\",\n\t\t\"company\",\n\t\t\"status\",\n\t\t\"posting_date\",\n\t]\n\n\tif (!props.id) excludeFields.push(...employeeFields)\n\treturn fields.filter((field) => !excludeFields.includes(field.fieldname))\n}\nlet start_time_s = null\nlet end_time_e = null\nfunction setFormReadOnly() {\n\tif (essdeePermissionApplication.value.permission_approver === employee.data.user_id) return\n\tformFields.data.map((field) => (field.read_only = true))\n}\n\nfunction validateDates(start_time, end_time) {\n\tif(start_time){\n\t\tif(typeof(start_time) == 'string'){\n\t\t\tstart_time_s = start_time\n\t\t}\n\t\telse{\n\t\t\tstart_time_s = start_time.target.value\n\t\t}\n\t}\n\tif(end_time){\n\t\tif(typeof(end_time) == 'string'){\n\t\t\tend_time_e = end_time\n\t\t}\n\t\telse{\n\t\t\tend_time_e = end_time.target.value\n\t\t}\n\t}\n}\n\nfunction setPermissionApprovers(data) {\n\tconst permission_approver = formFields.data?.find(\n\t\t(field) => field.fieldname === \"permission_approver\"\n\t)\n\tpermission_approver.reqd = data?.is_mandatory\n\tpermission_approver.documentList = data?.department_approvers.map((approver) => ({\n\t\tlabel: approver.full_name\n\t\t\t? `${approver.name} : ${approver.full_name}`\n\t\t\t: approver.name,\n\t\tvalue: approver.name,\n\t}))\n\n\tessdeePermissionApplication.value.permission_approver = data?.permission_approver\n}\n\nfunction areValuesSet() {\n\treturn (\n\t\tessdeePermissionApplication.value.start_date &&\n\t\tessdeePermissionApplication.value.end_date &&\n\t\tessdeePermissionApplication.value.permission_type\n\t)\n}\n\nfunction validateForm() {\n\tif(start_time_s && start_time_s.length < 7){\n\t\tstart_time_s = start_time_s + \":00\"\n\t}\n\tif(end_time_e && end_time_e.length < 7){\n\t\tend_time_e = end_time_e + \":00\"\n\t}\n\tessdeePermissionApplication.value.employee = employee.data.name\n\tessdeePermissionApplication.value.start_time = start_time_s\n\tessdeePermissionApplication.value.end_time = end_time_e\n}\n</script>\n"],"names":["dayjs","inject","employee","today","props","__props","essdeePermissionApplication","ref","formFields","createResource","data","getFilteredFields","field","_data","permissionApprovalDetails","hide_fields","setPermissionApprovers","watch","employee_id","setFormReadOnly","permission_type","j","temp","start_time","end_time","validateDates","fields","excludeFields","employeeFields","start_time_s","end_time_e","permission_approver","_a","approver","validateForm"],"mappings":"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"}
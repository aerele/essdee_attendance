import{b as x,c as D}from"./index-BxNz1Obz.js";import{i as f,a as S,O as _,w as u,j as y,y as v,n as g,l as Y,q as m,a5 as k}from"./frappe-ui-DZDZpt4w.js";import q from"./FormView-CS-B2Mga.js";import"./FormField-7rSNy-En.js";import"./Link-WtJjedfJ.js";import"./FileUploaderView-C4tMF-0v.js";import"./WorkflowActionSheet-tSPgpAX-.js";import"./workflow-CgWnsJgA.js";import"./currencies-SJR35BQj.js";import"./formatters-Ch330Bw1.js";const z={__name:"Form",props:{id:{type:String,required:!1}},setup(h){const F=f("$dayjs"),r=f("$employee"),P=F().format("YYYY-MM-DD"),d=h,l=S({}),s=_({url:"essdee_attendance.api.get_doctype_fields",params:{doctype:"Essdee Permission Application"},transform(e){return A(e).map(i=>(i.fieldname==="posting_date"&&(i.default=P),i))},onSuccess(e){V.reload()}});s.reload();let c=["end_time","end_date"];const V=_({url:"essdee_attendance.api.get_permission_approval_details",params:{employee:r.data.name},onSuccess(e){w(e)}});u(()=>l.value.employee,e=>{d.id&&e!==r.data.name&&b()}),u(()=>[l.value.permission_type,l.value],([e,t])=>{if(e=="Personal Permission"&&t.docstatus!=0){for(let i=0;i<c.length;i++)for(let a=0;a<s.data.length;a++)if(c.includes(s.data[a].fieldname)){let p=s.data;a==s.data.length-1?s.data=p.slice(0,s.data.length-1):s.data=p.slice(0,a).concat(p.slice(a+1,s.data.length))}}else s.reload()}),u(()=>[l.value.start_time,l.value.end_time],([e,t])=>{j(e,t)});function A(e){const t=["naming_series","sb_other_details","salary_slip","letter_head"],i=["employee","employee_name","department","designation","company","status","posting_date"];return d.id||t.push(...i),e.filter(a=>!t.includes(a.fieldname))}let n=null,o=null;function b(){l.value.permission_approver!==r.data.user_id&&s.data.map(e=>e.read_only=!0)}function j(e,t){e&&(typeof e=="string"?n=e:n=e.target.value),t&&(typeof t=="string"?o=t:o=t.target.value)}function w(e){var i;const t=(i=s.data)==null?void 0:i.find(a=>a.fieldname==="permission_approver");t.reqd=e==null?void 0:e.is_mandatory,t.documentList=e==null?void 0:e.department_approvers.map(a=>({label:a.full_name?`${a.name} : ${a.full_name}`:a.name,value:a.name})),l.value.permission_approver=e==null?void 0:e.permission_approver}function $(){n&&n.length<7&&(n=n+":00"),o&&o.length<7&&(o=o+":00"),l.value.employee=r.data.name,l.value.start_time=n,l.value.end_time=o}return(e,t)=>(y(),v(m(D),null,{default:g(()=>[Y(m(x),{fullscreen:!0},{default:g(()=>[m(s).data?(y(),v(q,{key:0,doctype:"Essdee Permission Application",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=i=>l.value=i),isSubmittable:!0,fields:m(s).data,id:d.id,showAttachmentView:!0,onValidateForm:$},null,8,["modelValue","fields","id"])):k("",!0)]),_:1})]),_:1}))}};export{z as default};
//# sourceMappingURL=Form-DVL_nkE0.js.map

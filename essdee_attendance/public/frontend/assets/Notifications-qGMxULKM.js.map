{"version":3,"file":"Notifications-qGMxULKM.js","sources":["../../../../frontend/src/views/Notifications.vue"],"sourcesContent":["<template>\n\t<ion-page>\n\t\t<ion-content class=\"ion-padding\">\n\t\t\t<div class=\"flex flex-col h-screen w-screen\">\n\t\t\t\t<div class=\"w-full sm:w-96\">\n\t\t\t\t\t<header\n\t\t\t\t\t\tclass=\"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b sticky top-0 z-10\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex flex-row items-center\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tclass=\"!pl-0 hover:bg-white\"\n\t\t\t\t\t\t\t\t@click=\"router.back()\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"chevron-left\" class=\"h-5 w-5\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<h2 class=\"text-xl font-semibold text-gray-900\">Notifications</h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\n\t\t\t\t\t<div class=\"flex flex-col gap-4 mt-5 p-4\">\n\t\t\t\t\t\t<div class=\"flex flex-row justify-between items-center\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"text-lg text-gray-800 font-semibold\"\n\t\t\t\t\t\t\t\tv-if=\"unreadNotificationsCount.data\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ unreadNotificationsCount.data }} Unread\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex ml-auto gap-1\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tv-if=\"allowPushNotifications\"\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t@click=\"router.push({ name: 'Settings' })\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t\t<FeatherIcon name=\"settings\" class=\"w-4\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\tSettings\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tv-if=\"unreadNotificationsCount.data\"\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t@click=\"markAllAsRead.submit\"\n\t\t\t\t\t\t\t\t\t:loading=\"markAllAsRead.loading\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t\t<FeatherIcon name=\"check-circle\" class=\"w-4\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\tMark all as read\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex flex-col bg-white rounded\"\n\t\t\t\t\t\t\tv-if=\"notifications.data?.length\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<router-link\n\t\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t\t'flex flex-row items-start p-4 justify-between border-b before:mt-3',\n\t\t\t\t\t\t\t\t\t`before:content-[''] before:mr-2 before:shrink-0 before:w-1.5 before:h-1.5 before:rounded-full`,\n\t\t\t\t\t\t\t\t\titem.read ? 'bg-white-500' : 'before:bg-blue-500',\n\t\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t\t\tv-for=\"item in notifications.data\"\n\t\t\t\t\t\t\t\t:key=\"item.name\"\n\t\t\t\t\t\t\t\t:to=\"getItemRoute(item)\"\n\t\t\t\t\t\t\t\t@click=\"markAsRead(item.name)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<EmployeeAvatar :userID=\"item.from_user\" size=\"lg\" />\n\t\t\t\t\t\t\t\t<div class=\"flex flex-col gap-0.5 grow ml-3\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"text-sm leading-5 font-normal text-gray-800\"\n\t\t\t\t\t\t\t\t\t\tv-html=\"item.message\"\n\t\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-xs font-normal text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t{{ dayjs(item.creation).fromNow() }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</router-link>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<EmptyState v-else message=\"You have no notifications\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ion-content>\n\t</ion-page>\n</template>\n\n<script setup>\nimport { IonContent, IonPage } from \"@ionic/vue\"\nimport { useRouter } from \"vue-router\"\nimport { createResource, FeatherIcon } from \"frappe-ui\"\n\nimport { computed, inject } from \"vue\"\nimport EmployeeAvatar from \"@/components/EmployeeAvatar.vue\"\nimport EmptyState from \"@/components/EmptyState.vue\"\n\nimport {\n\tunreadNotificationsCount,\n\tnotifications,\n\tarePushNotificationsEnabled,\n} from \"@/data/notifications\"\n\nconst user = inject(\"$user\")\nconst dayjs = inject(\"$dayjs\")\nconst router = useRouter()\n\nconst allowPushNotifications = computed(\n\t() =>\n\t\twindow.frappe?.boot.push_relay_server_url &&\n\t\tarePushNotificationsEnabled.data\n)\n\nconst markAllAsRead = createResource({\n\turl: \"essdee_attendance.api.mark_all_notifications_as_read\",\n\tonSuccess() {\n\t\tnotifications.reload()\n\t},\n})\n\nfunction markAsRead(name) {\n\tnotifications.setValue.submit(\n\t\t{ name, read: 1 },\n\t\t{\n\t\t\tonSuccess: () => {\n\t\t\t\tunreadNotificationsCount.reload()\n\t\t\t},\n\t\t}\n\t)\n}\n\nfunction getItemRoute(item) {\n\treturn {\n\t\tname: `${item.reference_document_type.replace(/\\s+/g, \"\")}DetailView`,\n\t\tparams: { id: item.reference_document_name },\n\t}\n}\n</script>\n"],"names":["inject","dayjs","router","useRouter","allowPushNotifications","computed","_a","arePushNotificationsEnabled","markAllAsRead","createResource","notifications","markAsRead","name","unreadNotificationsCount","getItemRoute","item"],"mappings":"8+BAwGaA,EAAO,OAAO,EAC3B,MAAMC,EAAQD,EAAO,QAAQ,EACvBE,EAASC,EAAW,EAEpBC,EAAyBC,EAC9B,IAAA,OACC,QAAAC,EAAA,OAAO,SAAP,YAAAA,EAAe,KAAK,wBACpBC,EAA4B,KAC9B,EAEMC,EAAgBC,EAAe,CACpC,IAAK,uDACL,WAAY,CACXC,EAAc,OAAQ,CACtB,CACF,CAAC,EAED,SAASC,EAAWC,EAAM,CACzBF,EAAc,SAAS,OACtB,CAAE,KAAAE,EAAM,KAAM,CAAG,EACjB,CACC,UAAW,IAAM,CAChBC,EAAyB,OAAQ,CACjC,CACD,CACD,CACF,CAEA,SAASC,EAAaC,EAAM,CAC3B,MAAO,CACN,KAAM,GAAGA,EAAK,wBAAwB,QAAQ,OAAQ,EAAE,CAAC,aACzD,OAAQ,CAAE,GAAIA,EAAK,uBAAyB,CAC5C,CACF"}
{"version":3,"file":"leaves-YLIW9pOG.js","sources":["../../../../frontend/src/data/leaves.js"],"sourcesContent":["import { createResource } from \"frappe-ui\"\nimport { employeeResource } from \"./employee\"\n\nimport dayjs from \"@/utils/dayjs\"\n\nconst transformLeaveData = (data) => {\n\treturn data.map((leave) => {\n\t\tleave.leave_dates = getLeaveDates(leave)\n\t\tleave.doctype = \"Leave Application\"\n\t\treturn leave\n\t})\n}\n\nexport const getLeaveDates = (leave) => {\n\tif (leave.from_date == leave.to_date)\n\t\treturn dayjs(leave.from_date).format(\"D MMM\")\n\telse\n\t\treturn `${dayjs(leave.from_date).format(\"D MMM\")} - ${dayjs(\n\t\t\tleave.to_date\n\t\t).format(\"D MMM\")}`\n}\n\nexport const myLeaves = createResource({\n\turl: \"essdee_attendance.api.get_leave_applications\",\n\tparams: {\n\t\temployee: employeeResource.data.name,\n\t\tlimit: 10,\n\t},\n\tauto: true,\n\tcache: \"hrms:my_leaves\",\n\ttransform(data) {\n\t\treturn transformLeaveData(data)\n\t},\n\tonSuccess() {\n\t\tleaveBalance.reload()\n\t},\n})\n\nexport const teamLeaves = createResource({\n\turl: \"essdee_attendance.api.get_leave_applications\",\n\tparams: {\n\t\temployee: employeeResource.data.name,\n\t\tapprover_id: employeeResource.data.user_id,\n\t\tfor_approval: 1,\n\t\tlimit: 10,\n\t},\n\tauto: true,\n\tcache: \"hrms:team_leaves\",\n\ttransform(data) {\n\t\treturn transformLeaveData(data)\n\t},\n})\n\nexport const leaveBalance = createResource({\n\turl: \"essdee_attendance.api.get_leave_balance_map\",\n\tparams: {\n\t\temployee: employeeResource.data.name,\n\t},\n\tauto: true,\n\tcache: \"hrms:leave_balance\",\n\ttransform: (data) => {\n\t\t// Calculate balance percentage for each leave type\n\t\treturn Object.fromEntries(\n\t\t\tObject.entries(data).map(([leave_type, allocation]) => {\n\t\t\t\tallocation.balance_percentage =\n\t\t\t\t\t(allocation.balance_leaves / allocation.allocated_leaves) * 100\n\t\t\t\treturn [leave_type, allocation]\n\t\t\t})\n\t\t)\n\t},\n})\n"],"names":["transformLeaveData","data","leave","getLeaveDates","dayjs","myLeaves","createResource","employeeResource","leaveBalance","teamLeaves","leave_type","allocation"],"mappings":"2FAKA,MAAMA,EAAsBC,GACpBA,EAAK,IAAKC,IAChBA,EAAM,YAAcC,EAAcD,CAAK,EACvCA,EAAM,QAAU,oBACTA,EACP,EAGWC,EAAiBD,GACzBA,EAAM,WAAaA,EAAM,QACrBE,EAAMF,EAAM,SAAS,EAAE,OAAO,OAAO,EAErC,GAAGE,EAAMF,EAAM,SAAS,EAAE,OAAO,OAAO,CAAC,MAAME,EACrDF,EAAM,OACT,EAAI,OAAO,OAAO,CAAC,GAGNG,EAAWC,EAAe,CACtC,IAAK,+CACL,OAAQ,CACP,SAAUC,EAAiB,KAAK,KAChC,MAAO,EACP,EACD,KAAM,GACN,MAAO,iBACP,UAAUN,EAAM,CACf,OAAOD,EAAmBC,CAAI,CAC9B,EACD,WAAY,CACXO,EAAa,OAAQ,CACrB,CACF,CAAC,EAEYC,EAAaH,EAAe,CACxC,IAAK,+CACL,OAAQ,CACP,SAAUC,EAAiB,KAAK,KAChC,YAAaA,EAAiB,KAAK,QACnC,aAAc,EACd,MAAO,EACP,EACD,KAAM,GACN,MAAO,mBACP,UAAUN,EAAM,CACf,OAAOD,EAAmBC,CAAI,CAC9B,CACF,CAAC,EAEYO,EAAeF,EAAe,CAC1C,IAAK,8CACL,OAAQ,CACP,SAAUC,EAAiB,KAAK,IAChC,EACD,KAAM,GACN,MAAO,qBACP,UAAYN,GAEJ,OAAO,YACb,OAAO,QAAQA,CAAI,EAAE,IAAI,CAAC,CAACS,EAAYC,CAAU,KAChDA,EAAW,mBACTA,EAAW,eAAiBA,EAAW,iBAAoB,IACtD,CAACD,EAAYC,CAAU,EAC9B,CACD,CAEH,CAAC"}
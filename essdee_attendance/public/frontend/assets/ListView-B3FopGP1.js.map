{"version":3,"file":"ListView-B3FopGP1.js","sources":["../../../../frontend/src/components/ListView.vue"],"sourcesContent":["<template>\n\t<ion-header class=\"ion-no-border\">\n\t\t<div class=\"w-full sm:w-96\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b\"\n\t\t\t>\n\t\t\t\t<div class=\"flex flex-row items-center\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tclass=\"!pl-0 hover:bg-white\"\n\t\t\t\t\t\t@click=\"router.back()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FeatherIcon name=\"chevron-left\" class=\"h-5 w-5\" />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<h2 class=\"text-xl font-semibold text-gray-900\">{{ pageTitle }}</h2>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex flex-row gap-2\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tid=\"show-filter-modal\"\n\t\t\t\t\t\ticon=\"filter\"\n\t\t\t\t\t\tvariant=\"subtle\"\n\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\tareFiltersApplied\n\t\t\t\t\t\t\t\t? '!border !border-gray-800 !bg-white !text-gray-900 !font-semibold'\n\t\t\t\t\t\t\t\t: '',\n\t\t\t\t\t\t]\"\n\t\t\t\t\t/>\n\t\t\t\t\t<router-link :to=\"{ name: formViewRoute }\" v-slot=\"{ navigate }\">\n\t\t\t\t\t\t<Button variant=\"solid\" class=\"mr-2\" @click=\"navigate\">\n\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"plus\" class=\"w-4\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\tNew\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</router-link>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</ion-header>\n\n\t<ion-content>\n\t\t<ion-refresher slot=\"fixed\" @ionRefresh=\"handleRefresh($event)\">\n\t\t\t<ion-refresher-content></ion-refresher-content>\n\t\t</ion-refresher>\n\n\t\t<div\n\t\t\tclass=\"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto\"\n\t\t\tref=\"scrollContainer\"\n\t\t\t@scroll=\"() => handleScroll()\"\n\t\t>\n\t\t\t<div class=\"w-full mt-5\">\n\t\t\t\t<TabButtons\n\t\t\t\t\t:buttons=\"[{ label: tabButtons[0] }, { label: tabButtons[1] }]\"\n\t\t\t\t\tv-model=\"activeTab\"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex flex-col bg-white rounded mt-5\"\n\t\t\t\t\tv-if=\"!documents.loading && documents.data?.length\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"p-3.5 items-center justify-between border-b cursor-pointer\"\n\t\t\t\t\t\tv-for=\"link in documents.data\"\n\t\t\t\t\t\t:key=\"link.name\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<router-link\n\t\t\t\t\t\t\t:to=\"{ name: detailViewRoute, params: { id: link.name } }\"\n\t\t\t\t\t\t\tv-slot=\"{ navigate }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t:is=\"listItemComponent[doctype]\"\n\t\t\t\t\t\t\t\t:doc=\"link\"\n\t\t\t\t\t\t\t\t:isTeamRequest=\"isTeamRequest\"\n\t\t\t\t\t\t\t\t:workflowStateField=\"workflowStateField\"\n\t\t\t\t\t\t\t\t@click=\"navigate\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</router-link>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState\n\t\t\t\t\t:message=\"`No ${props.doctype?.toLowerCase()}s found`\"\n\t\t\t\t\tv-else-if=\"!documents.loading\"\n\t\t\t\t/>\n\n\t\t\t\t<!-- Loading Indicator -->\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"documents.loading\"\n\t\t\t\t\tclass=\"flex mt-2 items-center justify-center\"\n\t\t\t\t>\n\t\t\t\t\t<LoadingIndicator class=\"w-8 h-8 text-gray-800\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<CustomIonModal trigger=\"show-filter-modal\">\n\t\t\t<!-- Filter Action Sheet -->\n\t\t\t<template #actionSheet>\n\t\t\t\t<ListFiltersActionSheet\n\t\t\t\t\t:filterConfig=\"filterConfig\"\n\t\t\t\t\t@applyFilters=\"applyFilters\"\n\t\t\t\t\t@clearFilters=\"clearFilters\"\n\t\t\t\t\tv-model:filters=\"filterMap\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</CustomIonModal>\n\t</ion-content>\n</template>\n\n<script setup>\nimport { useRouter } from \"vue-router\"\nimport { inject, ref, markRaw, watch, computed, reactive, onMounted } from \"vue\"\nimport {\n\tmodalController,\n\tIonHeader,\n\tIonContent,\n\tIonRefresher,\n\tIonRefresherContent,\n} from \"@ionic/vue\"\n\nimport {\n\tFeatherIcon,\n\tcreateResource,\n\tLoadingIndicator,\n\tdebounce,\n} from \"frappe-ui\"\n\nimport TabButtons from \"@/components/TabButtons.vue\"\nimport LeaveRequestItem from \"@/components/LeaveRequestItem.vue\"\nimport ExpenseClaimItem from \"@/components/ExpenseClaimItem.vue\"\nimport EmployeeAdvanceItem from \"@/components/EmployeeAdvanceItem.vue\"\nimport ListFiltersActionSheet from \"@/components/ListFiltersActionSheet.vue\"\nimport CustomIonModal from \"@/components/CustomIonModal.vue\"\n\nimport useWorkflow from \"@/composables/workflow\"\nimport { useListUpdate } from \"@/composables/realtime\"\n\nconst props = defineProps({\n\tdoctype: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tfields: {\n\t\ttype: Array,\n\t\trequired: true,\n\t},\n\tgroupBy: {\n\t\ttype: String,\n\t\trequired: false,\n\t},\n\tfilterConfig: {\n\t\ttype: Array,\n\t\trequired: true,\n\t},\n\ttabButtons: {\n\t\ttype: Array,\n\t\trequired: true,\n\t},\n\tpageTitle: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n})\n\nconst listItemComponent = {\n\t\"Leave Application\": markRaw(LeaveRequestItem),\n\t\"Expense Claim\": markRaw(ExpenseClaimItem),\n\t\"Employee Advance\": markRaw(EmployeeAdvanceItem),\n}\n\nconst router = useRouter()\nconst socket = inject(\"$socket\")\nconst employee = inject(\"$employee\")\nconst filterMap = reactive({})\nconst activeTab = ref(props.tabButtons[0])\nconst areFiltersApplied = ref(false)\nconst appliedFilters = ref([])\nconst workflowStateField = ref(null)\n\n// infinite scroll\nconst scrollContainer = ref(null)\nconst hasNextPage = ref(true)\nconst listOptions = ref({\n\tdoctype: props.doctype,\n\tfields: props.fields,\n\tgroup_by: props.groupBy,\n\torder_by: `\\`tab${props.doctype}\\`.modified desc`,\n\tpage_length: 50,\n})\n\n// computed properties\nconst isTeamRequest = computed(() => {\n\treturn activeTab.value === props.tabButtons[1]\n})\n\nconst formViewRoute = computed(() => {\n\treturn `${props.doctype.replace(/\\s+/g, \"\")}FormView`\n})\n\nconst detailViewRoute = computed(() => {\n\treturn `${props.doctype.replace(/\\s+/g, \"\")}DetailView`\n})\n\nconst defaultFilters = computed(() => {\n\tconst filters = []\n\n\tif (isTeamRequest.value) {\n\t\tfilters.push([props.doctype, \"employee\", \"!=\", employee.data.name])\n\t} else {\n\t\tfilters.push([props.doctype, \"employee\", \"=\", employee.data.name])\n\t}\n\n\treturn filters\n})\n\n// resources\nconst documents = createResource({\n\turl: \"frappe.desk.reportview.get\",\n\tonSuccess: (data) => {\n\t\tif (data.values?.length < listOptions.value.page_length) {\n\t\t\thasNextPage.value = false\n\t\t}\n\t},\n\ttransform(data) {\n\t\tif (data.length === 0) {\n\t\t\treturn []\n\t\t}\n\n\t\t// convert keys and values arrays to docs object\n\t\tconst fields = data[\"keys\"]\n\t\tconst values = data[\"values\"]\n\t\tconst docs = values.map((value) => {\n\t\t\tconst doc = {}\n\t\t\tfields.forEach((field, index) => {\n\t\t\t\tdoc[field] = value[index]\n\t\t\t})\n\t\t\treturn doc\n\t\t})\n\n\t\tlet pagedData\n\t\tif (!documents.params.start || documents.params.start === 0) {\n\t\t\tpagedData = docs\n\t\t} else {\n\t\t\tpagedData = documents.data.concat(docs)\n\t\t}\n\n\t\treturn pagedData\n\t},\n})\n\n// helper functions\nfunction initializeFilters() {\n\tprops.filterConfig.forEach((filter) => {\n\t\tfilterMap[filter.fieldname] = {\n\t\t\tcondition: \"=\",\n\t\t\tvalue: null,\n\t\t}\n\t})\n\n\tappliedFilters.value = []\n}\ninitializeFilters()\n\nfunction prepareFilters() {\n\tlet condition = \"\"\n\tlet value = \"\"\n\tappliedFilters.value = []\n\n\tfor (const fieldname in filterMap) {\n\t\tcondition = filterMap[fieldname].condition\n\t\t// accessing .value because autocomplete returns an object instead of value\n\t\tif (typeof condition === \"object\" && condition !== null) {\n\t\t\tcondition = condition.value\n\t\t}\n\n\t\tvalue = filterMap[fieldname].value\n\t\tif (condition && value)\n\t\t\tappliedFilters.value.push([props.doctype, fieldname, condition, value])\n\t}\n}\n\nfunction applyFilters() {\n\tprepareFilters()\n\tfetchDocumentList()\n\tmodalController.dismiss()\n\tareFiltersApplied.value = appliedFilters.value.length ? true : false\n}\n\nfunction clearFilters() {\n\tinitializeFilters()\n\tfetchDocumentList()\n\tmodalController.dismiss()\n\tareFiltersApplied.value = false\n}\n\nfunction fetchDocumentList(start = 0) {\n\tif (start === 0) {\n\t\thasNextPage.value = true\n\t}\n\n\tconst filters = [[props.doctype, \"docstatus\", \"!=\", \"2\"]]\n\tfilters.push(...defaultFilters.value)\n\n\tif (appliedFilters.value) filters.push(...appliedFilters.value)\n\n\tif (workflowStateField.value) {\n\t\tlistOptions.value.fields.push(workflowStateField.value)\n\t}\n\n\tdocuments.submit({\n\t\t...listOptions.value,\n\t\tstart: start || 0,\n\t\tfilters: filters,\n\t})\n}\n\nconst handleScroll = debounce(() => {\n\tif (!hasNextPage.value) return\n\n\tconst { scrollTop, scrollHeight, clientHeight } = scrollContainer.value\n\tconst scrollPercentage = (scrollTop / (scrollHeight - clientHeight)) * 100\n\n\tif (scrollPercentage >= 90) {\n\t\tconst start = documents.params.start + listOptions.value.page_length\n\t\tfetchDocumentList(start)\n\t}\n}, 500)\n\nconst handleRefresh = (event) => {\n\tsetTimeout(() => {\n\t\tfetchDocumentList()\n\t\tevent.target.complete()\n\t}, 500)\n}\n\nwatch(\n\t() => activeTab.value,\n\t(_value) => {\n\t\tfetchDocumentList()\n\t}\n)\n\nonMounted(async () => {\n\tconst workflow = useWorkflow(props.doctype)\n\tawait workflow.workflowDoc.promise\n\tworkflowStateField.value = workflow.getWorkflowStateField()\n\tfetchDocumentList()\n\n\tuseListUpdate(socket, props.doctype, () => fetchDocumentList())\n})\n</script>\n"],"names":["props","__props","listItemComponent","markRaw","LeaveRequestItem","ExpenseClaimItem","EmployeeAdvanceItem","router","useRouter","socket","inject","employee","filterMap","reactive","activeTab","ref","areFiltersApplied","appliedFilters","workflowStateField","scrollContainer","hasNextPage","listOptions","isTeamRequest","computed","formViewRoute","detailViewRoute","defaultFilters","filters","documents","createResource","data","_a","fields","docs","value","doc","field","index","pagedData","initializeFilters","filter","prepareFilters","condition","fieldname","applyFilters","fetchDocumentList","modalController","clearFilters","start","__spreadProps","__spreadValues","handleScroll","debounce","scrollTop","scrollHeight","clientHeight","handleRefresh","event","watch","_value","onMounted","__async","workflow","useWorkflow","useListUpdate"],"mappings":"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"}
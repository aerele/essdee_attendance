{"version":3,"file":"Profile-ooCBKIm4.js","sources":["../../../../frontend/src/utils/dialogs.js","../../../../frontend/src/views/Profile.vue"],"sourcesContent":["export const showErrorAlert = async (message) => {\n\tconst alert = await alertController.create({\n\t\theader: \"Error\",\n\t\tmessage,\n\t\tbuttons: [\"OK\"],\n\t})\n\n\tawait alert.present()\n}\n\nimport { alertController } from \"@ionic/vue\"\n","<template>\n\t<ion-page>\n\t\t<ion-content class=\"ion-padding\">\n\t\t\t<div class=\"flex flex-col h-screen w-screen\">\n\t\t\t\t<div class=\"w-full sm:w-96\">\n\t\t\t\t\t<header\n\t\t\t\t\t\tclass=\"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b sticky top-0 z-10\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex flex-row items-center\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tclass=\"!pl-0 hover:bg-white\"\n\t\t\t\t\t\t\t\t@click=\"router.back()\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"chevron-left\" class=\"h-5 w-5\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<h2 class=\"text-xl font-semibold text-gray-900\">Profile</h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\n\t\t\t\t\t<div class=\"flex flex-col items-center mt-5 p-4\">\n\t\t\t\t\t\t<!-- Profile Image -->\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tv-if=\"user.data.user_image\"\n\t\t\t\t\t\t\tclass=\"h-24 w-24 rounded-full object-cover\"\n\t\t\t\t\t\t\t:src=\"user.data.user_image\"\n\t\t\t\t\t\t\t:alt=\"user.data.first_name\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"flex items-center justify-center bg-gray-200 uppercase text-gray-600 h-24 w-24 rounded-full object-cover\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ user.data.first_name[0] }}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex flex-col gap-1.5 items-center mt-2 mb-5\">\n\t\t\t\t\t\t\t<span v-if=\"employee\" class=\"text-lg font-bold text-gray-900\">{{\n\t\t\t\t\t\t\t\temployee?.data?.employee_name\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t\t<span v-if=\"employee\" class=\"font-normal text-sm text-gray-500\">{{\n\t\t\t\t\t\t\t\temployee?.data?.designation\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- Profile Links -->\n\t\t\t\t\t\t<div class=\"flex flex-col gap-5 my-4 w-full\">\n\t\t\t\t\t\t\t<div class=\"flex flex-col bg-white rounded\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"flex flex-row cursor-pointer flex-start p-4 items-center justify-between border-b\"\n\t\t\t\t\t\t\t\t\tv-for=\"link in profileLinks\"\n\t\t\t\t\t\t\t\t\t:key=\"link.title\"\n\t\t\t\t\t\t\t\t\t@click=\"openInfoModal(link)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-row items-center gap-3 grow\">\n\t\t\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t\t\t:name=\"link.icon\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5 text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-base font-normal text-gray-800\">\n\t\t\t\t\t\t\t\t\t\t\t{{ link.title }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t\tname=\"chevron-right\"\n\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5 text-gray-500\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- Settings -->\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex flex-col gap-5 my-4 w-full\"\n\t\t\t\t\t\t\tv-if=\"allowPushNotifications\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col bg-white rounded\">\n\t\t\t\t\t\t\t\t<router-link\n\t\t\t\t\t\t\t\t\t:to=\"{ name: 'Settings' }\"\n\t\t\t\t\t\t\t\t\tclass=\"flex flex-row cursor-pointer flex-start p-4 items-center justify-between border-b\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-row items-center gap-3 grow\">\n\t\t\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t\t\tname=\"settings\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5 text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-base font-normal text-gray-800\">\n\t\t\t\t\t\t\t\t\t\t\tSettings\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t\tname=\"chevron-right\"\n\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5 text-gray-500\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</router-link>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t@click=\"logout\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\ttheme=\"red\"\n\t\t\t\t\t\t\tclass=\"w-full shadow py-4 mt-5\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"log-out\" class=\"w-4\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\tLog Out\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<ion-modal\n\t\t\t\tref=\"modal\"\n\t\t\t\t:is-open=\"isInfoModalOpen\"\n\t\t\t\t@didDismiss=\"closeInfoModal\"\n\t\t\t\t:initial-breakpoint=\"1\"\n\t\t\t\t:breakpoints=\"[0, 1]\"\n\t\t\t>\n\t\t\t\t<ProfileInfoModal\n\t\t\t\t\t:title=\"selectedItem.title\"\n\t\t\t\t\t:data=\"\n\t\t\t\t\t\tselectedItem.fields.map((field) => {\n\t\t\t\t\t\t\tconst [label, fieldtype] = getFieldInfo(field)\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tfieldname: field,\n\t\t\t\t\t\t\t\tvalue: employeeDoc.doc[field],\n\t\t\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\t\t\tfieldtype: fieldtype,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\"\n\t\t\t\t/>\n\t\t\t</ion-modal>\n\t\t</ion-content>\n\t</ion-page>\n</template>\n\n<script setup>\nimport { computed, inject, ref, onMounted, onBeforeUnmount } from \"vue\"\nimport { useRouter } from \"vue-router\"\nimport { IonModal, IonPage, IonContent } from \"@ionic/vue\"\nimport { FeatherIcon, createDocumentResource, createResource } from \"frappe-ui\"\n\nimport { showErrorAlert } from \"@/utils/dialogs\"\nimport { formatCurrency } from \"@/utils/formatters\"\n\nimport ProfileInfoModal from \"@/components/ProfileInfoModal.vue\"\n\nimport { arePushNotificationsEnabled } from \"@/data/notifications\"\n\nconst DOCTYPE = \"Employee\"\n\nconst socket = inject(\"$socket\")\nconst session = inject(\"$session\")\nconst user = inject(\"$user\")\nconst employee = inject(\"$employee\")\n\nconst router = useRouter()\n\nconst profileLinks = [\n\t{\n\t\ticon: \"user\",\n\t\ttitle: \"Employee Details\",\n\t\tfields: [\n\t\t\t\"employee_name\",\n\t\t\t\"employee_number\",\n\t\t\t\"gender\",\n\t\t\t\"date_of_birth\",\n\t\t\t\"date_of_joining\",\n\t\t\t\"blood_group\",\n\t\t],\n\t},\n\t{\n\t\ticon: \"file\",\n\t\ttitle: \"Company Information\",\n\t\tfields: [\n\t\t\t\"company\",\n\t\t\t\"department\",\n\t\t\t\"designation\",\n\t\t\t\"branch\",\n\t\t\t\"grade\",\n\t\t\t\"reports_to\",\n\t\t\t\"employment_type\",\n\t\t],\n\t},\n\t{\n\t\ticon: \"book\",\n\t\ttitle: \"Contact Information\",\n\t\tfields: [\n\t\t\t\"cell_number\",\n\t\t\t\"personal_email\",\n\t\t\t\"company_email\",\n\t\t\t\"preferred_email\",\n\t\t],\n\t},\n\t{\n\t\ticon: \"dollar-sign\",\n\t\ttitle: \"Salary Information\",\n\t\tfields: [\n\t\t\t\"ctc\",\n\t\t\t\"payroll_cost_center\",\n\t\t\t\"pan_number\",\n\t\t\t\"provident_fund_account\",\n\t\t\t\"salary_mode\",\n\t\t\t\"bank_name\",\n\t\t\t\"bank_ac_no\",\n\t\t\t\"ifsc_code\",\n\t\t\t\"micr_code\",\n\t\t\t\"iban\",\n\t\t],\n\t},\n]\n\nconst isInfoModalOpen = ref(false)\nconst selectedItem = ref(null)\n\nconst allowPushNotifications = computed(\n\t() =>\n\t\twindow.frappe?.boot.push_relay_server_url &&\n\t\tarePushNotificationsEnabled.data\n)\n\nconst openInfoModal = async (request) => {\n\tselectedItem.value = request\n\tisInfoModalOpen.value = true\n}\n\nconst closeInfoModal = async (_request) => {\n\tisInfoModalOpen.value = false\n\tselectedItem.value = null\n}\n\nconst employeeDoc = createDocumentResource({\n\tdoctype: DOCTYPE,\n\tname: employee.data.name,\n\tfields: \"*\",\n\tauto: true,\n\ttransform: (data) => {\n\t\tdata.ctc = formatCurrency(data.ctc, data.salary_currency)\n\t\treturn data\n\t},\n})\n\nconst employeeDocType = createResource({\n\turl: \"essdee_attendance.api.get_doctype_fields\",\n\tparams: { doctype: DOCTYPE },\n\tauto: true,\n})\n\nconst getFieldInfo = (fieldname) => {\n\tconst field = employeeDocType.data.find(\n\t\t(field) => field.fieldname === fieldname\n\t)\n\treturn [field?.label, field?.fieldtype]\n}\n\nconst logout = async () => {\n\ttry {\n\t\tawait session.logout.submit()\n\t} catch (e) {\n\t\tconst msg = \"An error occurred while attempting to log out!\"\n\t\tconsole.error(msg, e)\n\t\tshowErrorAlert(msg)\n\t}\n}\n\nonMounted(() => {\n\tsocket.emit(\"doctype_subscribe\", DOCTYPE)\n\tsocket.on(\"list_update\", (data) => {\n\t\tif (data.doctype === DOCTYPE && data.name === employee.data.name) {\n\t\t\temployeeDoc.reload()\n\t\t}\n\t})\n})\n\nonBeforeUnmount(() => {\n\tsocket.emit(\"doctype_unsubscribe\", DOCTYPE)\n\tsocket.off(\"list_update\")\n})\n</script>\n"],"names":["showErrorAlert","message","__async","alertController","DOCTYPE","socket","inject","session","user","employee","router","useRouter","profileLinks","isInfoModalOpen","ref","selectedItem","allowPushNotifications","computed","_a","arePushNotificationsEnabled","openInfoModal","request","closeInfoModal","_request","employeeDoc","createDocumentResource","data","formatCurrency","employeeDocType","createResource","getFieldInfo","fieldname","field","logout","e","msg","onMounted","onBeforeUnmount"],"mappings":"sqBAAO,MAAMA,GAAwBC,GAAYC,EAAA,wBAOhD,MANc,MAAMC,EAAgB,OAAO,CAC1C,OAAQ,QACR,QAAAF,EACA,QAAS,CAAC,IAAI,CAChB,CAAE,GAEW,QAAS,CACtB,kjCC+IMG,EAAU,yCAEhB,MAAMC,EAASC,EAAO,SAAS,EACzBC,EAAUD,EAAO,UAAU,EAC3BE,EAAOF,EAAO,OAAO,EACrBG,EAAWH,EAAO,WAAW,EAE7BI,EAASC,EAAW,EAEpBC,EAAe,CACpB,CACC,KAAM,OACN,MAAO,mBACP,OAAQ,CACP,gBACA,kBACA,SACA,gBACA,kBACA,aACA,CACD,EACD,CACC,KAAM,OACN,MAAO,sBACP,OAAQ,CACP,UACA,aACA,cACA,SACA,QACA,aACA,iBACA,CACD,EACD,CACC,KAAM,OACN,MAAO,sBACP,OAAQ,CACP,cACA,iBACA,gBACA,iBACA,CACD,EACD,CACC,KAAM,cACN,MAAO,qBACP,OAAQ,CACP,MACA,sBACA,aACA,yBACA,cACA,YACA,aACA,YACA,YACA,MACA,CACD,CACF,EAEMC,EAAkBC,EAAI,EAAK,EAC3BC,EAAeD,EAAI,IAAI,EAEvBE,EAAyBC,EAC9B,IAAA,OACC,QAAAC,EAAA,OAAO,SAAP,YAAAA,EAAe,KAAK,wBACpBC,GAA4B,KAC9B,EAEMC,EAAuBC,GAAYnB,EAAA,sBACxCa,EAAa,MAAQM,EACrBR,EAAgB,MAAQ,EACzB,GAEMS,EAAwBC,GAAarB,EAAA,sBAC1CW,EAAgB,MAAQ,GACxBE,EAAa,MAAQ,IACtB,GAEMS,EAAcC,EAAuB,CAC1C,QAASrB,EACT,KAAMK,EAAS,KAAK,KACpB,OAAQ,IACR,KAAM,GACN,UAAYiB,IACXA,EAAK,IAAMC,GAAeD,EAAK,IAAKA,EAAK,eAAe,EACjDA,EAET,CAAC,EAEKE,EAAkBC,EAAe,CACtC,IAAK,2CACL,OAAQ,CAAE,QAASzB,CAAS,EAC5B,KAAM,EACP,CAAC,EAEK0B,EAAgBC,GAAc,CACnC,MAAMC,EAAQJ,EAAgB,KAAK,KACjCI,GAAUA,EAAM,YAAcD,CAC/B,EACD,MAAO,CAACC,GAAA,YAAAA,EAAO,MAAOA,GAAA,YAAAA,EAAO,SAAS,CACvC,EAEMC,EAAS,IAAY/B,EAAA,sBAC1B,GAAI,CACH,MAAMK,EAAQ,OAAO,OAAQ,CAC7B,OAAQ2B,EAAG,CACX,MAAMC,EAAM,iDACZ,QAAQ,MAAMA,EAAKD,CAAC,EACpBlC,GAAemC,CAAG,CAClB,CACF,GAEA,OAAAC,EAAU,IAAM,CACf/B,EAAO,KAAK,oBAAqBD,CAAO,EACxCC,EAAO,GAAG,cAAgBqB,GAAS,CAC9BA,EAAK,UAAYtB,GAAWsB,EAAK,OAASjB,EAAS,KAAK,MAC3De,EAAY,OAAQ,CAEvB,CAAE,CACF,CAAC,EAEDa,EAAgB,IAAM,CACrBhC,EAAO,KAAK,sBAAuBD,CAAO,EAC1CC,EAAO,IAAI,aAAa,CACzB,CAAC"}
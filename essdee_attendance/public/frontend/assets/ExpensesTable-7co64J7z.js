var H=Object.defineProperty;var I=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var D=(t,o,a)=>o in t?H(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,V=(t,o)=>{for(var a in o||(o={}))K.call(o,a)&&D(t,a,o[a]);if(I)for(var a of I(o))L.call(o,a)&&D(t,a,o[a]);return t};var q=(t,o,a)=>new Promise((v,w)=>{var n=i=>{try{m(a.next(i))}catch(x){w(x)}},r=i=>{try{m(a.throw(i))}catch(x){w(x)}},m=i=>i.done?v(i.value):Promise.resolve(i.value).then(n,r);m((a=a.apply(t,o)).next())});import{i as z,a as g,O as G,c as F,w as R,f as J,j as c,k as p,x as s,K as f,q as u,y as k,a5 as C,F as O,H as N,l as _,t as $,n as b,v as T}from"./frappe-ui-DZDZpt4w.js";import P from"./FormField-7rSNy-En.js";import{_ as Q}from"./index-DY6of2et.js";import W from"./CustomIonModal-BGmNRiHp.js";import{c as X}from"./claims-B88SfAug.js";import{f as B}from"./formatters-Ch330Bw1.js";import"./Link-WtJjedfJ.js";const Y={class:"flex flex-row justify-between items-center mt-2"},Z=s("h2",{class:"text-base font-semibold text-gray-800"},"Expenses",-1),ee={class:"flex flex-row gap-3 items-center"},te={class:"text-base font-semibold text-gray-800"},se={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},ae=["onClick"],le={class:"flex flex-col w-full justify-center gap-2.5"},ne={class:"flex flex-row items-center justify-between"},oe={class:"flex flex-row items-start gap-3 grow"},ie={class:"flex flex-col items-start gap-1.5"},de={class:"text-base font-normal text-gray-800"},re={class:"text-xs font-normal text-gray-500"},ce=s("span",{class:"whitespace-pre"}," Â· ",-1),ue={key:0,class:"whitespace-nowrap"},me={class:"flex flex-row justify-end items-center gap-2"},pe={class:"text-gray-700 font-normal rounded text-base"},fe={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},xe={class:"w-full pt-8 pb-5 border-b text-center"},ve={class:"text-gray-900 font-bold text-lg"},ye={class:"w-full flex flex-col items-center justify-center gap-5 p-4"},_e={class:"flex flex-col w-full space-y-4"},be={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},Be={__name:"ExpensesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-item","update-expense-item","delete-expense-item"],setup(t,{emit:o}){const a=t,v=o,w=z("$dayjs"),n=g({}),r=g(null),m=g(!1),i=g(!1),x=(d,l)=>q(this,null,function*(){d&&(n.value=V({},d),r.value=l),i.value=!0,m.value=!0}),M=()=>{v("delete-expense-item",r.value),j()},S=()=>{r.value===null?v("add-expense-item",n.value):v("update-expense-item",n.value,r.value),j()};function j(){i.value=!1,m.value=!1,n.value={},r.value=null}const E=G({url:"essdee_attendance.api.get_doctype_fields",params:{doctype:"Expense Claim Detail"},transform(d){const l=["description_sb","amounts_sb"];return d.filter(y=>!l.includes(y.fieldname))}});E.reload();const U=F(()=>a.isReadOnly?"Expense Item":r.value===null?"New Expense Item":"Edit Expense Item"),A=F(()=>{var d;return(d=E.data)==null?void 0:d.some(l=>{if(l.reqd&&!n.value[l.fieldname])return!0})});return R(()=>n.value.expense_type,d=>{var l;n.value.description||(n.value.description=(l=X[d])==null?void 0:l.description),n.value.cost_center=a.expenseClaim.cost_center}),R(()=>n.value.amount,d=>{i.value?i.value=!1:n.value.sanctioned_amount=parseFloat(d)}),(d,l)=>{const y=J("Button");return c(),p(O,null,[s("div",Y,[Z,s("div",ee,[s("span",te,f(u(B)(t.expenseClaim.total_claimed_amount,t.currency)),1),t.isReadOnly?C("",!0):(c(),k(y,{key:0,id:"add-expense-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:l[0]||(l[0]=e=>x())}))])]),t.expenseClaim.expenses?(c(),p("div",se,[(c(!0),p(O,null,N(t.expenseClaim.expenses,(e,h)=>(c(),p("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:h,onClick:we=>x(e,h)},[s("div",le,[s("div",ne,[s("div",oe,[s("div",ie,[s("div",de,f(e.expense_type),1),s("div",re,[s("span",null," Sanctioned: "+f(u(B)(e.sanctioned_amount,t.currency)),1),ce,e.expense_date?(c(),p("span",ue,f(u(w)(e.expense_date).format("D MMM")),1)):C("",!0)])])]),s("div",me,[s("span",pe,f(u(B)(e.amount,t.currency)),1),_(u($),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,ae))),128))])):(c(),k(Q,{key:1,message:"No expenses added",isTableField:!0})),_(W,{isOpen:m.value,onDidDismiss:l[3]||(l[3]=e=>j())},{actionSheet:b(()=>[s("div",fe,[s("div",xe,[s("span",ve,f(U.value),1)]),s("div",ye,[s("div",_e,[(c(!0),p(O,null,N(u(E).data,e=>(c(),k(P,{key:e.fieldname,class:"w-full",label:e.label,fieldtype:e.fieldtype,fieldname:e.fieldname,options:e.options,hidden:e.hidden,reqd:e.reqd,default:e.default,readOnly:e.read_only||t.isReadOnly,modelValue:n.value[e.fieldname],"onUpdate:modelValue":h=>n.value[e.fieldname]=h},null,8,["label","fieldtype","fieldname","options","hidden","reqd","default","readOnly","modelValue","onUpdate:modelValue"]))),128))]),t.isReadOnly?C("",!0):(c(),p("div",be,[r.value!==null?(c(),k(y,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:l[1]||(l[1]=e=>M())},{prefix:b(()=>[_(u($),{name:"trash",class:"w-4"})]),default:b(()=>[T(" Delete ")]),_:1})):C("",!0),_(y,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:l[2]||(l[2]=e=>S()),disabled:A.value},{prefix:b(()=>[_(u($),{name:r.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[T(" "+f(r.value===null?"Add Expense":"Update Expense"),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)}}};export{Be as default};
//# sourceMappingURL=ExpensesTable-7co64J7z.js.map

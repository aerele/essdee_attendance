import{i as k,a as u,O as S,aa as O,c as _,e as V,ab as q,f as z,j as c,k as r,x as a,K as n,q as l,F as g,a5 as f,y as F,n as N,l as P,v as R,a7 as T}from"./frappe-ui-DZDZpt4w.js";import{I as U,m as A}from"./index-DY6of2et.js";const H={class:"flex flex-col bg-white rounded w-full py-6 px-4 border-none"},K={class:"text-lg font-bold text-gray-900"},G={key:0,class:"font-medium text-sm text-gray-500 mt-1.5"},J={key:1,class:"font-medium text-sm text-gray-500 mt-1.5"},L={class:"h-120 w-full flex flex-col items-center justify-center gap-5 p-4 mb-5"},Q={class:"flex flex-col gap-1.5 mt-2 items-center justify-center"},W={class:"font-bold text-xl"},X={class:"font-medium text-gray-500 text-sm"},Z={key:0,class:"font-medium text-gray-500 text-sm"},ee={class:"rounded border-4 translate-z-0 block overflow-hidden w-full h-170"},te=["src"],p="Employee Checkin",le={__name:"CheckInPanel",setup(oe){const m=k("$socket"),y=k("$employee"),t=k("$dayjs"),v=u(null),x=u(0),b=u(0),C=u(""),h=S({url:"essdee_attendance.api.get_hr_settings",auto:!0}),i=O({doctype:p,fields:["name","employee","employee_name","log_type","time","device_id"],filters:{employee:y.data.name},orderBy:"time desc"});i.reload();const o=_(()=>i.list.loading||!i.data?{}:i.data[0]),j=_(()=>{var e;return((e=o==null?void 0:o.value)==null?void 0:e.log_type)==="IN"?"check-in":"check-out"}),M=_(()=>{var e;return((e=o==null?void 0:o.value)==null?void 0:e.log_type)==="IN"?{action:"OUT",label:"Check Out"}:{action:"IN",label:"Check In"}}),D=_(()=>{var d;const e=(d=o==null?void 0:o.value)==null?void 0:d.time,s=t(e).format("hh:mm a");return t(e).isToday()?s:t(e).isYesterday()?`${s} yesterday`:t(e).isSame(t(),"year")?`${s} on ${t(e).format("D MMM")}`:`${s} on ${t(e).format("D MMM, YYYY")}`}),E=e=>{const s=e==="IN"?"Check-in":"Check-out";i.insert.submit({employee:y.data.name,log_type:e,time:v.value,latitude:x.value,longitude:b.value},{onSuccess(){A.dismiss(),T({title:"Success",text:`${s} successful!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){T({title:"Error",text:`${s} failed!`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}})};return V(()=>{m.emit("doctype_subscribe",p),m.on("list_update",e=>{e.doctype==p&&i.reload()})}),q(()=>{m.emit("doctype_unsubscribe",p),m.off("list_update")}),(e,s)=>{var Y,w,$,B;const d=z("Button");return c(),r(g,null,[a("div",H,[a("h2",K,"Hey, "+n((w=(Y=l(y))==null?void 0:Y.data)==null?void 0:w.first_name)+" ðŸ‘‹",1),($=l(h).data)!=null&&$.allow_employee_checkin_from_mobile_app?(c(),r(g,{key:0},[o.value?(c(),r("div",G," Last "+n(j.value)+" was at "+n(D.value),1)):f("",!0)],64)):(c(),r("div",J,n(l(t)().format("ddd, D MMMM, YYYY")),1))]),(B=l(h).data)!=null&&B.allow_employee_checkin_from_mobile_app?(c(),F(l(U),{key:0,ref:"modal",trigger:"open-checkin-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:N(()=>{var I;return[a("div",L,[a("div",Q,[a("div",W,n(l(t)(v.value).format("hh:mm:ss a")),1),a("div",X,n(l(t)().format("D MMM, YYYY")),1)]),(I=l(h).data)!=null&&I.allow_geolocation_tracking?(c(),r(g,{key:0},[C.value?(c(),r("span",Z,n(C.value),1)):f("",!0),a("div",ee,[a("iframe",{width:"100%",height:"170",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",style:{border:"0"},src:`https://maps.google.com/maps?q=${x.value},${b.value}&hl=en&z=15&output=embed`},null,8,te)])],64)):f("",!0),P(d,{variant:"solid",class:"w-full py-5 text-sm",onClick:s[0]||(s[0]=se=>E(M.value.action))},{default:N(()=>[R(" Confirm "+n(M.value.label),1)]),_:1})])]}),_:1},512)):f("",!0)],64)}}};export{le as default};
//# sourceMappingURL=CheckInPanel-DttegPpz.js.map

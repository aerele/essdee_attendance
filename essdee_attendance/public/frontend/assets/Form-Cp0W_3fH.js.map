{"version":3,"file":"Form-Cp0W_3fH.js","sources":["../../../../frontend/src/views/employee_advance/Form.vue"],"sourcesContent":["<template>\n\t<ion-page>\n\t\t<ion-content :fullscreen=\"true\">\n\t\t\t<FormView\n\t\t\t\tv-if=\"formFields.data\"\n\t\t\t\tdoctype=\"Employee Advance\"\n\t\t\t\tv-model=\"employeeAdvance\"\n\t\t\t\t:isSubmittable=\"true\"\n\t\t\t\t:fields=\"formFields.data\"\n\t\t\t\t:id=\"props.id\"\n\t\t\t\t:showAttachmentView=\"true\"\n\t\t\t\t@validateForm=\"validateForm\"\n\t\t\t/>\n\t\t</ion-content>\n\t</ion-page>\n</template>\n\n<script setup>\nimport { IonPage, IonContent } from \"@ionic/vue\"\nimport { createResource } from \"frappe-ui\"\nimport { ref, watch, inject, computed } from \"vue\"\n\nimport FormView from \"@/components/FormView.vue\"\n\nimport { getCompanyCurrency } from \"@/data/currencies\"\n\nconst employee = inject(\"$employee\")\n\nconst props = defineProps({\n\tid: {\n\t\ttype: String,\n\t\trequired: false,\n\t},\n})\n\n// object to store form data\nconst employeeAdvance = ref({\n\temployee: employee.data.name,\n\temployee_name: employee.data.employee_name,\n\tcompany: employee.data.company,\n\tdepartment: employee.data.department,\n})\n\nconst companyCurrency = computed(() =>\n\tgetCompanyCurrency(employeeAdvance.value.company)\n)\n\n// get form fields\nconst formFields = createResource({\n\turl: \"essdee_attendance.api.get_doctype_fields\",\n\tparams: { doctype: \"Employee Advance\" },\n\ttransform(data) {\n\t\tconst fields = getFilteredFields(data)\n\t\treturn applyFilters(fields)\n\t},\n\tonSuccess(_) {\n\t\temployeeCurrency.reload()\n\t\tadvanceAccount.reload()\n\t},\n})\nformFields.reload()\n\nconst employeeCurrency = createResource({\n\turl: \"hrms.payroll.doctype.salary_structure_assignment.salary_structure_assignment.get_employee_currency\",\n\tparams: { employee: employee.data.name },\n\tonSuccess(data) {\n\t\temployeeAdvance.value.currency = data\n\t\tsetExchangeRate()\n\t},\n})\n\nconst exchangeRate = createResource({\n\turl: \"erpnext.setup.utils.get_exchange_rate\",\n\tonSuccess(data) {\n\t\temployeeAdvance.value.exchange_rate = data\n\t},\n})\n\nconst advanceAccount = createResource({\n\turl: \"essdee_attendance.api.get_advance_account\",\n\tparams: { company: employeeAdvance.value.company },\n\tonSuccess(data) {\n\t\temployeeAdvance.value.advance_account = data\n\t},\n})\n\n// form scripts\nwatch(\n\t() => employeeAdvance.value.currency,\n\t() => setExchangeRate()\n)\n\n// helper functions\nfunction getFilteredFields(fields) {\n\t// reduce noise from the form view by excluding unnecessary fields\n\t// eg: employee and other details can be fetched from the session user\n\tconst excludeFields = [\"naming_series\"]\n\tconst extraFields = [\n\t\t\"employee\",\n\t\t\"employee_name\",\n\t\t\"department\",\n\t\t\"company\",\n\t\t\"more_info_section\",\n\t\t\"pending_amount\",\n\t]\n\n\tif (!props.id) excludeFields.push(...extraFields)\n\n\treturn fields.filter((field) => !excludeFields.includes(field.fieldname))\n}\n\nfunction applyFilters(fields) {\n\treturn fields.map((field) => {\n\t\tif (field.fieldname === \"advance_account\") {\n\t\t\tlet currencies = [employeeAdvance.value.currency]\n\t\t\tif (employeeAdvance.value.currency != companyCurrency.value)\n\t\t\t\tcurrencies.push(companyCurrency.value)\n\n\t\t\tfield.linkFilters = {\n\t\t\t\tcompany: employeeAdvance.value.company,\n\t\t\t\tis_group: 0,\n\t\t\t\troot_type: \"Asset\",\n\t\t\t\taccount_currency: (\"in\", currencies),\n\t\t\t}\n\t\t}\n\n\t\treturn field\n\t})\n}\n\nfunction setExchangeRate() {\n\tif (!employeeAdvance.value.currency) return\n\tconst exchange_rate_field = formFields.data?.find(\n\t\t(field) => field.fieldname === \"exchange_rate\"\n\t)\n\n\tif (employeeAdvance.value.currency === companyCurrency.value) {\n\t\temployeeAdvance.value.exchange_rate = 1\n\t\texchange_rate_field.hidden = 1\n\t} else {\n\t\texchangeRate.fetch({\n\t\t\tfrom_currency: employeeAdvance.value.currency,\n\t\t\tto_currency: companyCurrency.value,\n\t\t})\n\t\texchange_rate_field.hidden = 0\n\t}\n}\n\nfunction validateForm() {}\n</script>\n"],"names":["employee","inject","props","__props","employeeAdvance","ref","companyCurrency","computed","getCompanyCurrency","formFields","createResource","data","fields","getFilteredFields","applyFilters","_","employeeCurrency","advanceAccount","setExchangeRate","exchangeRate","watch","excludeFields","extraFields","field","currencies","exchange_rate_field","_a","validateForm"],"mappings":"sgBA0BA,MAAMA,EAAWC,EAAO,WAAW,EAE7BC,EAAQC,EAQRC,EAAkBC,EAAI,CAC3B,SAAUL,EAAS,KAAK,KACxB,cAAeA,EAAS,KAAK,cAC7B,QAASA,EAAS,KAAK,QACvB,WAAYA,EAAS,KAAK,UAC3B,CAAC,EAEKM,EAAkBC,EAAS,IAChCC,EAAmBJ,EAAgB,MAAM,OAAO,CACjD,EAGMK,EAAaC,EAAe,CACjC,IAAK,2CACL,OAAQ,CAAE,QAAS,kBAAoB,EACvC,UAAUC,EAAM,CACf,MAAMC,EAASC,EAAkBF,CAAI,EACrC,OAAOG,EAAaF,CAAM,CAC1B,EACD,UAAUG,EAAG,CACZC,EAAiB,OAAQ,EACzBC,EAAe,OAAQ,CACvB,CACF,CAAC,EACDR,EAAW,OAAQ,EAEnB,MAAMO,EAAmBN,EAAe,CACvC,IAAK,qGACL,OAAQ,CAAE,SAAUV,EAAS,KAAK,IAAM,EACxC,UAAUW,EAAM,CACfP,EAAgB,MAAM,SAAWO,EACjCO,EAAiB,CACjB,CACF,CAAC,EAEKC,EAAeT,EAAe,CACnC,IAAK,wCACL,UAAUC,EAAM,CACfP,EAAgB,MAAM,cAAgBO,CACtC,CACF,CAAC,EAEKM,EAAiBP,EAAe,CACrC,IAAK,4CACL,OAAQ,CAAE,QAASN,EAAgB,MAAM,OAAS,EAClD,UAAUO,EAAM,CACfP,EAAgB,MAAM,gBAAkBO,CACxC,CACF,CAAC,EAGDS,EACC,IAAMhB,EAAgB,MAAM,SAC5B,IAAMc,EAAiB,CACxB,EAGA,SAASL,EAAkBD,EAAQ,CAGlC,MAAMS,EAAgB,CAAC,eAAe,EAChCC,EAAc,CACnB,WACA,gBACA,aACA,UACA,oBACA,gBACA,EAED,OAAKpB,EAAM,IAAImB,EAAc,KAAK,GAAGC,CAAW,EAEzCV,EAAO,OAAQW,GAAU,CAACF,EAAc,SAASE,EAAM,SAAS,CAAC,CACzE,CAEA,SAAST,EAAaF,EAAQ,CAC7B,OAAOA,EAAO,IAAKW,GAAU,CAC5B,GAAIA,EAAM,YAAc,kBAAmB,CAC1C,IAAIC,EAAa,CAACpB,EAAgB,MAAM,QAAQ,EAC5CA,EAAgB,MAAM,UAAYE,EAAgB,OACrDkB,EAAW,KAAKlB,EAAgB,KAAK,EAEtCiB,EAAM,YAAc,CACnB,QAASnB,EAAgB,MAAM,QAC/B,SAAU,EACV,UAAW,QACX,iBAAyBoB,CACzB,CACD,CAED,OAAOD,CACT,CAAE,CACF,CAEA,SAASL,GAAkB,OAC1B,GAAI,CAACd,EAAgB,MAAM,SAAU,OACrC,MAAMqB,GAAsBC,EAAAjB,EAAW,OAAX,YAAAiB,EAAiB,KAC3CH,GAAUA,EAAM,YAAc,iBAG5BnB,EAAgB,MAAM,WAAaE,EAAgB,OACtDF,EAAgB,MAAM,cAAgB,EACtCqB,EAAoB,OAAS,IAE7BN,EAAa,MAAM,CAClB,cAAef,EAAgB,MAAM,SACrC,YAAaE,EAAgB,KAChC,CAAG,EACDmB,EAAoB,OAAS,EAE/B,CAEA,SAASE,GAAe,CAAE"}
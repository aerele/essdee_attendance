{"version":3,"file":"ExpensesTable-7co64J7z.js","sources":["../../../../frontend/src/components/ExpensesTable.vue"],"sourcesContent":["<template>\n\t<!-- Header -->\n\t<div class=\"flex flex-row justify-between items-center mt-2\">\n\t\t<h2 class=\"text-base font-semibold text-gray-800\">Expenses</h2>\n\t\t<div class=\"flex flex-row gap-3 items-center\">\n\t\t\t<span class=\"text-base font-semibold text-gray-800\">\n\t\t\t\t{{ formatCurrency(expenseClaim.total_claimed_amount, currency) }}\n\t\t\t</span>\n\t\t\t<Button\n\t\t\t\tv-if=\"!isReadOnly\"\n\t\t\t\tid=\"add-expense-modal\"\n\t\t\t\tclass=\"text-sm\"\n\t\t\t\ticon=\"plus\"\n\t\t\t\tvariant=\"subtle\"\n\t\t\t\t@click=\"openModal()\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t<!-- Table -->\n\t<div\n\t\tv-if=\"expenseClaim.expenses\"\n\t\tclass=\"flex flex-col bg-white mt-5 rounded border overflow-auto\"\n\t>\n\t\t<div\n\t\t\tclass=\"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer\"\n\t\t\tv-for=\"(item, idx) in expenseClaim.expenses\"\n\t\t\t:key=\"idx\"\n\t\t\t@click=\"openModal(item, idx)\"\n\t\t>\n\t\t\t<div class=\"flex flex-col w-full justify-center gap-2.5\">\n\t\t\t\t<div class=\"flex flex-row items-center justify-between\">\n\t\t\t\t\t<div class=\"flex flex-row items-start gap-3 grow\">\n\t\t\t\t\t\t<div class=\"flex flex-col items-start gap-1.5\">\n\t\t\t\t\t\t\t<div class=\"text-base font-normal text-gray-800\">\n\t\t\t\t\t\t\t\t{{ item.expense_type }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"text-xs font-normal text-gray-500\">\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\tSanctioned:\n\t\t\t\t\t\t\t\t\t{{ formatCurrency(item.sanctioned_amount, currency) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class=\"whitespace-pre\"> &middot; </span>\n\t\t\t\t\t\t\t\t<span class=\"whitespace-nowrap\" v-if=\"item.expense_date\">\n\t\t\t\t\t\t\t\t\t{{ dayjs(item.expense_date).format(\"D MMM\") }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"flex flex-row justify-end items-center gap-2\">\n\t\t\t\t\t\t<span class=\"text-gray-700 font-normal rounded text-base\">\n\t\t\t\t\t\t\t{{ formatCurrency(item.amount, currency) }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<FeatherIcon name=\"chevron-right\" class=\"h-5 w-5 text-gray-500\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<EmptyState v-else message=\"No expenses added\" :isTableField=\"true\" />\n\n\t<CustomIonModal :isOpen=\"isModalOpen\" @didDismiss=\"resetSelectedItem()\">\n\t\t<template #actionSheet>\n\t\t\t<!-- Add Expense Action Sheet -->\n\t\t\t<div\n\t\t\t\tclass=\"bg-white w-full flex flex-col items-center justify-center pb-5\"\n\t\t\t>\n\t\t\t\t<div class=\"w-full pt-8 pb-5 border-b text-center\">\n\t\t\t\t\t<span class=\"text-gray-900 font-bold text-lg\">\n\t\t\t\t\t\t{{ modalTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"w-full flex flex-col items-center justify-center gap-5 p-4\">\n\t\t\t\t\t<div class=\"flex flex-col w-full space-y-4\">\n\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\tv-for=\"field in expensesTableFields.data\"\n\t\t\t\t\t\t\t:key=\"field.fieldname\"\n\t\t\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\t\t\t:label=\"field.label\"\n\t\t\t\t\t\t\t:fieldtype=\"field.fieldtype\"\n\t\t\t\t\t\t\t:fieldname=\"field.fieldname\"\n\t\t\t\t\t\t\t:options=\"field.options\"\n\t\t\t\t\t\t\t:hidden=\"field.hidden\"\n\t\t\t\t\t\t\t:reqd=\"field.reqd\"\n\t\t\t\t\t\t\t:default=\"field.default\"\n\t\t\t\t\t\t\t:readOnly=\"field.read_only || isReadOnly\"\n\t\t\t\t\t\t\tv-model=\"expenseItem[field.fieldname]\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"!isReadOnly\"\n\t\t\t\t\t\tclass=\"flex w-full flex-row items-center justify-between gap-3\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tv-if=\"editingIdx !== null\"\n\t\t\t\t\t\t\tclass=\"border-red-600 text-red-600 py-5 text-sm\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\ttheme=\"red\"\n\t\t\t\t\t\t\t@click=\"deleteExpenseItem()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"trash\" class=\"w-4\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t\t\tclass=\"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white\"\n\t\t\t\t\t\t\t@click=\"updateExpenseItem()\"\n\t\t\t\t\t\t\t:disabled=\"addButtonDisabled\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t:name=\"editingIdx === null ? 'plus' : 'check'\"\n\t\t\t\t\t\t\t\t\tclass=\"w-4\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t{{ editingIdx === null ? \"Add Expense\" : \"Update Expense\" }}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</CustomIonModal>\n</template>\n\n<script setup>\nimport { FeatherIcon, createResource } from \"frappe-ui\"\nimport { computed, ref, watch, inject } from \"vue\"\n\nimport FormField from \"@/components/FormField.vue\"\nimport EmptyState from \"@/components/EmptyState.vue\"\nimport CustomIonModal from \"@/components/CustomIonModal.vue\"\n\nimport { claimTypesByID } from \"@/data/claims\"\nimport { formatCurrency } from \"@/utils/formatters\"\n\nconst props = defineProps({\n\texpenseClaim: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\tcurrency: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tisReadOnly: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n})\nconst emit = defineEmits([\n\t\"add-expense-item\",\n\t\"update-expense-item\",\n\t\"delete-expense-item\",\n])\nconst dayjs = inject(\"$dayjs\")\nconst expenseItem = ref({})\nconst editingIdx = ref(null)\n\nconst isModalOpen = ref(false)\nconst isFirstRender = ref(false)\n\nconst openModal = async (item, idx) => {\n\tif (item) {\n\t\texpenseItem.value = { ...item }\n\t\teditingIdx.value = idx\n\t}\n\tisFirstRender.value = true\n\tisModalOpen.value = true\n}\n\nconst deleteExpenseItem = () => {\n\temit(\"delete-expense-item\", editingIdx.value)\n\tresetSelectedItem()\n}\n\nconst updateExpenseItem = () => {\n\tif (editingIdx.value === null) {\n\t\temit(\"add-expense-item\", expenseItem.value)\n\t} else {\n\t\temit(\"update-expense-item\", expenseItem.value, editingIdx.value)\n\t}\n\tresetSelectedItem()\n}\n\nfunction resetSelectedItem() {\n\tisFirstRender.value = false\n\tisModalOpen.value = false\n\texpenseItem.value = {}\n\teditingIdx.value = null\n}\n\nconst expensesTableFields = createResource({\n\turl: \"essdee_attendance.api.get_doctype_fields\",\n\tparams: { doctype: \"Expense Claim Detail\" },\n\ttransform(data) {\n\t\tconst excludeFields = [\"description_sb\", \"amounts_sb\"]\n\t\treturn data.filter((field) => !excludeFields.includes(field.fieldname))\n\t},\n})\nexpensesTableFields.reload()\n\nconst modalTitle = computed(() => {\n\tif (props.isReadOnly) return \"Expense Item\"\n\n\treturn editingIdx.value === null ? \"New Expense Item\" : \"Edit Expense Item\"\n})\n\nconst addButtonDisabled = computed(() => {\n\treturn expensesTableFields.data?.some((field) => {\n\t\tif (field.reqd && !expenseItem.value[field.fieldname]) {\n\t\t\treturn true\n\t\t}\n\t})\n})\n\n// child table form scripts\nwatch(\n\t() => expenseItem.value.expense_type,\n\t(value) => {\n\t\tif (!expenseItem.value.description) {\n\t\t\texpenseItem.value.description = claimTypesByID[value]?.description\n\t\t}\n\n\t\texpenseItem.value.cost_center = props.expenseClaim.cost_center\n\t}\n)\n\nwatch(\n\t() => expenseItem.value.amount,\n\t(value) => {\n\t\tif (!isFirstRender.value) {\n\t\t\texpenseItem.value.sanctioned_amount = parseFloat(value)\n\t\t} else {\n\t\t\tisFirstRender.value = false\n\t\t}\n\t}\n)\n</script>\n"],"names":["props","__props","emit","__emit","dayjs","inject","expenseItem","ref","editingIdx","isModalOpen","isFirstRender","openModal","item","idx","__async","__spreadValues","deleteExpenseItem","resetSelectedItem","updateExpenseItem","expensesTableFields","createResource","data","excludeFields","field","modalTitle","computed","addButtonDisabled","_a","watch","value","claimTypesByID"],"mappings":"k1EA0IA,MAAMA,EAAQC,EAcRC,EAAOC,EAKPC,EAAQC,EAAO,QAAQ,EACvBC,EAAcC,EAAI,EAAE,EACpBC,EAAaD,EAAI,IAAI,EAErBE,EAAcF,EAAI,EAAK,EACvBG,EAAgBH,EAAI,EAAK,EAEzBI,EAAY,CAAOC,EAAMC,IAAQC,EAAA,sBAClCF,IACHN,EAAY,MAAQS,EAAA,GAAKH,GACzBJ,EAAW,MAAQK,GAEpBH,EAAc,MAAQ,GACtBD,EAAY,MAAQ,EACrB,GAEMO,EAAoB,IAAM,CAC/Bd,EAAK,sBAAuBM,EAAW,KAAK,EAC5CS,EAAmB,CACpB,EAEMC,EAAoB,IAAM,CAC3BV,EAAW,QAAU,KACxBN,EAAK,mBAAoBI,EAAY,KAAK,EAE1CJ,EAAK,sBAAuBI,EAAY,MAAOE,EAAW,KAAK,EAEhES,EAAmB,CACpB,EAEA,SAASA,GAAoB,CAC5BP,EAAc,MAAQ,GACtBD,EAAY,MAAQ,GACpBH,EAAY,MAAQ,CAAE,EACtBE,EAAW,MAAQ,IACpB,CAEA,MAAMW,EAAsBC,EAAe,CAC1C,IAAK,2CACL,OAAQ,CAAE,QAAS,sBAAwB,EAC3C,UAAUC,EAAM,CACf,MAAMC,EAAgB,CAAC,iBAAkB,YAAY,EACrD,OAAOD,EAAK,OAAQE,GAAU,CAACD,EAAc,SAASC,EAAM,SAAS,CAAC,CACtE,CACF,CAAC,EACDJ,EAAoB,OAAQ,EAE5B,MAAMK,EAAaC,EAAS,IACvBzB,EAAM,WAAmB,eAEtBQ,EAAW,QAAU,KAAO,mBAAqB,mBACxD,EAEKkB,EAAoBD,EAAS,IAAM,OACxC,OAAOE,EAAAR,EAAoB,OAApB,YAAAQ,EAA0B,KAAMJ,GAAU,CAChD,GAAIA,EAAM,MAAQ,CAACjB,EAAY,MAAMiB,EAAM,SAAS,EACnD,MAAO,EAEV,EACA,CAAC,EAGD,OAAAK,EACC,IAAMtB,EAAY,MAAM,aACvBuB,GAAU,OACLvB,EAAY,MAAM,cACtBA,EAAY,MAAM,aAAcqB,EAAAG,EAAeD,CAAK,IAApB,YAAAF,EAAuB,aAGxDrB,EAAY,MAAM,YAAcN,EAAM,aAAa,WACnD,CACF,EAEA4B,EACC,IAAMtB,EAAY,MAAM,OACvBuB,GAAU,CACLnB,EAAc,MAGlBA,EAAc,MAAQ,GAFtBJ,EAAY,MAAM,kBAAoB,WAAWuB,CAAK,CAIvD,CACF"}
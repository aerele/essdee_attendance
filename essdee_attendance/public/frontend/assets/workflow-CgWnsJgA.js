var m=(n,e,s)=>new Promise((w,c)=>{var d=r=>{try{p(s.next(r))}catch(t){c(t)}},i=r=>{try{p(s.throw(r))}catch(t){c(t)}},p=r=>r.done?w(r.value):Promise.resolve(r.value).then(d,i);p((s=s.apply(n,e)).next())});import{O as k,c as W,a7 as y}from"./frappe-ui-DZDZpt4w.js";import{u as g}from"./index-BxNz1Obz.js";function R(n){const e=k({url:"essdee_attendance.api.get_workflow",params:{doctype:n},cache:["hrms:workflow",n]});e.reload();const s=W(()=>{const t=e==null?void 0:e.data;return Object.keys(t||{}).length>0}),w=()=>{var t,o;return(t=e.data)!=null&&t.override_status?"":(o=e.data)==null?void 0:o.workflow_state_field},c=t=>{var o;return(o=e.data)==null?void 0:o.states.find(a=>a.doc_status==t)},d=t=>m(this,null,function*(){return yield k({url:"frappe.model.workflow.get_transitions",params:{doc:t},transform:a=>{var l,f;const _=((f=(l=g)==null?void 0:l.data)==null?void 0:f.name)==t.owner;return a.filter(u=>u.allow_self_approval||!_).map(u=>u.action)}}).reload()}),i=t=>{var o;return(o=e.data)==null?void 0:o.states.filter(a=>a.state==t).map(a=>a.allow_edit)};return{hasWorkflow:s,workflowDoc:e,getWorkflowStateField:w,getTransitions:d,getDocumentStateRoles:i,isReadOnly:t=>{var l;const o=(l=e.data)==null?void 0:l.workflow_state_field;if(!o)return!1;const a=t[o]||c(t.docstatus);return!i(a).some(f=>g.data.roles.includes(f))},applyWorkflow:(t,o)=>m(this,null,function*(){yield k({url:"frappe.model.workflow.apply_workflow",params:{doc:t,action:o},onSuccess(){y({title:"Success",text:`Workflow action '${o}' applied successfully`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){y({title:"Error",text:`Error applying workflow action: ${o}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error applying workflow action: ${o}`)}}).reload()})}}export{R as u};
//# sourceMappingURL=workflow-CgWnsJgA.js.map

{"version":3,"file":"ExpenseTaxesTable-D0X7C5DJ.js","sources":["../../../../frontend/src/components/ExpenseTaxesTable.vue"],"sourcesContent":["<template>\n\t<template v-if=\"expenseClaim.expenses\">\n\t\t<div class=\"flex flex-row justify-between items-center pt-4\">\n\t\t\t<h2 class=\"text-base font-semibold text-gray-800\">Taxes & Charges</h2>\n\t\t\t<div class=\"flex flex-row gap-3 items-center\">\n\t\t\t\t<span class=\"text-base font-semibold text-gray-800\">\n\t\t\t\t\t{{ formatCurrency(expenseClaim.total_taxes_and_charges, currency) }}\n\t\t\t\t</span>\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"!isReadOnly\"\n\t\t\t\t\tid=\"add-taxes-modal\"\n\t\t\t\t\tclass=\"text-sm\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\tvariant=\"subtle\"\n\t\t\t\t\t@click=\"openModal()\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div\n\t\t\tv-if=\"expenseClaim.taxes?.length\"\n\t\t\tclass=\"flex flex-col bg-white mt-5 rounded border overflow-auto\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer\"\n\t\t\t\tv-for=\"(item, idx) in expenseClaim.taxes\"\n\t\t\t\t:key=\"item.name\"\n\t\t\t\t@click=\"openModal(item, idx)\"\n\t\t\t>\n\t\t\t\t<div class=\"flex flex-col w-full justify-center gap-2.5\">\n\t\t\t\t\t<div class=\"flex flex-row items-center justify-between\">\n\t\t\t\t\t\t<div class=\"flex flex-row items-start gap-3 grow\">\n\t\t\t\t\t\t\t<div class=\"flex flex-col items-start gap-1.5\">\n\t\t\t\t\t\t\t\t<div class=\"text-base font-normal text-gray-800\">\n\t\t\t\t\t\t\t\t\t{{ item.account_head }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-xs font-normal text-gray-500\">\n\t\t\t\t\t\t\t\t\t<span> Rate: {{ formatCurrency(item.rate, currency) }} </span>\n\t\t\t\t\t\t\t\t\t<span class=\"whitespace-pre\"> &middot; </span>\n\t\t\t\t\t\t\t\t\t<span class=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\tAmount: {{ formatCurrency(item.tax_amount, currency) }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex flex-row justify-end items-center gap-2\">\n\t\t\t\t\t\t\t<span class=\"text-gray-700 font-normal rounded text-base\">\n\t\t\t\t\t\t\t\t{{ formatCurrency(item.total, currency) }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<FeatherIcon name=\"chevron-right\" class=\"h-5 w-5 text-gray-500\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<EmptyState v-else message=\"No taxes added\" :isTableField=\"true\" />\n\n\t\t<CustomIonModal :isOpen=\"isModalOpen\" @didDismiss=\"resetSelectedItem()\">\n\t\t\t<template #actionSheet>\n\t\t\t\t<!-- Add Expense Tax Action Sheet -->\n\t\t\t\t<div\n\t\t\t\t\tclass=\"bg-white w-full flex flex-col items-center justify-center pb-5\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full pt-8 pb-5 border-b text-center\">\n\t\t\t\t\t\t<span class=\"text-gray-900 font-bold text-xl\">\n\t\t\t\t\t\t\t{{ modalTitle }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"w-full flex flex-col items-center justify-center gap-5 p-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex flex-col w-full space-y-4\">\n\t\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\t\tv-for=\"field in taxesTableFields.data\"\n\t\t\t\t\t\t\t\t:key=\"field.fieldname\"\n\t\t\t\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\t\t\t\t:label=\"field.label\"\n\t\t\t\t\t\t\t\t:fieldtype=\"field.fieldtype\"\n\t\t\t\t\t\t\t\t:fieldname=\"field.fieldname\"\n\t\t\t\t\t\t\t\t:options=\"field.options\"\n\t\t\t\t\t\t\t\t:linkFilters=\"field.linkFilters\"\n\t\t\t\t\t\t\t\t:hidden=\"field.hidden\"\n\t\t\t\t\t\t\t\t:reqd=\"field.reqd\"\n\t\t\t\t\t\t\t\t:readOnly=\"field.read_only || isReadOnly\"\n\t\t\t\t\t\t\t\t:default=\"field.default\"\n\t\t\t\t\t\t\t\tv-model=\"expenseTax[field.fieldname]\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"!isReadOnly\"\n\t\t\t\t\t\t\tclass=\"flex w-full flex-row items-center justify-between gap-3\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-if=\"editingIdx !== null\"\n\t\t\t\t\t\t\t\tclass=\"border-red-600 text-red-600 py-5 text-sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\ttheme=\"red\"\n\t\t\t\t\t\t\t\t@click=\"deleteExpenseTax()\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t<FeatherIcon name=\"trash\" class=\"w-4\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t\t\t\tclass=\"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white\"\n\t\t\t\t\t\t\t\t@click=\"updateExpenseTax()\"\n\t\t\t\t\t\t\t\t:disabled=\"addButtonDisabled\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t\t:name=\"editingIdx === null ? 'plus' : 'check'\"\n\t\t\t\t\t\t\t\t\t\tclass=\"w-4\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t{{ editingIdx === null ? \"Add Tax\" : \"Update Tax\" }}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</CustomIonModal>\n\t</template>\n</template>\n\n<script setup>\nimport { FeatherIcon, createResource } from \"frappe-ui\"\nimport { computed, ref, watch } from \"vue\"\n\nimport FormField from \"@/components/FormField.vue\"\nimport EmptyState from \"@/components/EmptyState.vue\"\nimport CustomIonModal from \"@/components/CustomIonModal.vue\"\n\nimport { formatCurrency } from \"@/utils/formatters\"\n\nconst props = defineProps({\n\texpenseClaim: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\tcurrency: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tisReadOnly: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n})\nconst emit = defineEmits([\n\t\"add-expense-tax\",\n\t\"update-expense-tax\",\n\t\"delete-expense-tax\",\n])\nconst expenseTax = ref({})\nconst editingIdx = ref(null)\n\nconst isModalOpen = ref(false)\nconst openModal = async (item, idx) => {\n\tif (item) {\n\t\texpenseTax.value = { ...item }\n\t\teditingIdx.value = idx\n\t}\n\tisModalOpen.value = true\n}\n\nconst deleteExpenseTax = () => {\n\temit(\"delete-expense-tax\", editingIdx.value)\n\tresetSelectedItem()\n}\n\nconst updateExpenseTax = () => {\n\tif (editingIdx.value === null) {\n\t\temit(\"add-expense-tax\", expenseTax.value)\n\t} else {\n\t\temit(\"update-expense-tax\", expenseTax.value, editingIdx.value)\n\t}\n\tresetSelectedItem()\n}\n\nfunction resetSelectedItem() {\n\tisModalOpen.value = false\n\texpenseTax.value = {}\n\teditingIdx.value = null\n}\n\nconst taxesTableFields = createResource({\n\turl: \"essdee_attendance.api.get_doctype_fields\",\n\tparams: { doctype: \"Expense Taxes and Charges\" },\n\ttransform(data) {\n\t\tconst excludeFields = [\"description_sb\"]\n\t\treturn data\n\t\t\t.map((field) => {\n\t\t\t\tif (field.fieldname === \"account_head\") {\n\t\t\t\t\tfield.linkFilters = {\n\t\t\t\t\t\tcompany: props.expenseClaim.company,\n\t\t\t\t\t\taccount_type: [\n\t\t\t\t\t\t\t\"in\",\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\"Tax\",\n\t\t\t\t\t\t\t\t\"Chargeable\",\n\t\t\t\t\t\t\t\t\"Income Account\",\n\t\t\t\t\t\t\t\t\"Expenses Included In Valuation\",\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t],\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn field\n\t\t\t})\n\t\t\t.filter((field) => !excludeFields.includes(field.fieldname))\n\t},\n})\ntaxesTableFields.reload()\n\nconst modalTitle = computed(() => {\n\tif (props.isReadOnly) return \"Expense Tax\"\n\n\treturn editingIdx.value === null ? \"New Expense Tax\" : \"Edit Expense Tax\"\n})\n\nconst addButtonDisabled = computed(() => {\n\treturn taxesTableFields.data?.some((field) => {\n\t\tif (field.reqd && !expenseTax.value[field.fieldname]) {\n\t\t\treturn true\n\t\t}\n\t})\n})\n\n// child table scripts\nwatch(\n\t() => expenseTax.value.account_head,\n\t(value) => {\n\t\t// set description from account head\n\t\texpenseTax.value.description = value?.split(\" - \").slice(0, -1).join(\" - \")\n\t}\n)\n\nwatch(\n\t() => expenseTax.value.rate,\n\t(newVal, oldVal) => {\n\t\tif (editingIdx.value && newVal && !oldVal) return\n\n\t\texpenseTax.value.tax_amount =\n\t\t\tparseFloat(props.expenseClaim.total_sanctioned_amount) *\n\t\t\t(parseFloat(newVal) / 100)\n\t\tcalculateTotalTax()\n\t}\n)\n\nwatch(\n\t() => expenseTax.value.tax_amount,\n\t(_value) => {\n\t\tcalculateTotalTax()\n\t}\n)\n\nfunction calculateTotalTax() {\n\texpenseTax.value.total =\n\t\tparseFloat(props.expenseClaim.total_sanctioned_amount) +\n\t\tparseFloat(expenseTax.value.tax_amount)\n}\n</script>\n"],"names":["props","__props","emit","__emit","expenseTax","ref","editingIdx","isModalOpen","openModal","item","idx","__async","__spreadValues","deleteExpenseTax","resetSelectedItem","updateExpenseTax","taxesTableFields","createResource","data","excludeFields","field","modalTitle","computed","addButtonDisabled","_a","watch","value","newVal","oldVal","calculateTotalTax","_value"],"mappings":"kyEAyIA,MAAMA,EAAQC,EAcRC,EAAOC,EAKPC,EAAaC,EAAI,EAAE,EACnBC,EAAaD,EAAI,IAAI,EAErBE,EAAcF,EAAI,EAAK,EACvBG,EAAY,CAAOC,EAAMC,IAAQC,EAAA,sBAClCF,IACHL,EAAW,MAAQQ,EAAA,GAAKH,GACxBH,EAAW,MAAQI,GAEpBH,EAAY,MAAQ,EACrB,GAEMM,EAAmB,IAAM,CAC9BX,EAAK,qBAAsBI,EAAW,KAAK,EAC3CQ,EAAmB,CACpB,EAEMC,EAAmB,IAAM,CAC1BT,EAAW,QAAU,KACxBJ,EAAK,kBAAmBE,EAAW,KAAK,EAExCF,EAAK,qBAAsBE,EAAW,MAAOE,EAAW,KAAK,EAE9DQ,EAAmB,CACpB,EAEA,SAASA,GAAoB,CAC5BP,EAAY,MAAQ,GACpBH,EAAW,MAAQ,CAAE,EACrBE,EAAW,MAAQ,IACpB,CAEA,MAAMU,EAAmBC,EAAe,CACvC,IAAK,2CACL,OAAQ,CAAE,QAAS,2BAA6B,EAChD,UAAUC,EAAM,CACf,MAAMC,EAAgB,CAAC,gBAAgB,EACvC,OAAOD,EACL,IAAKE,IACDA,EAAM,YAAc,iBACvBA,EAAM,YAAc,CACnB,QAASpB,EAAM,aAAa,QAC5B,aAAc,CACb,KACA,CACC,MACA,aACA,iBACA,gCACA,CACD,CACD,GAEKoB,EACP,EACA,OAAQA,GAAU,CAACD,EAAc,SAASC,EAAM,SAAS,CAAC,CAC5D,CACF,CAAC,EACDJ,EAAiB,OAAQ,EAEzB,MAAMK,EAAaC,EAAS,IACvBtB,EAAM,WAAmB,cAEtBM,EAAW,QAAU,KAAO,kBAAoB,kBACvD,EAEKiB,EAAoBD,EAAS,IAAM,OACxC,OAAOE,EAAAR,EAAiB,OAAjB,YAAAQ,EAAuB,KAAMJ,GAAU,CAC7C,GAAIA,EAAM,MAAQ,CAAChB,EAAW,MAAMgB,EAAM,SAAS,EAClD,MAAO,EAEV,EACA,CAAC,EAGDK,EACC,IAAMrB,EAAW,MAAM,aACtBsB,GAAU,CAEVtB,EAAW,MAAM,YAAcsB,GAAA,YAAAA,EAAO,MAAM,OAAO,MAAM,EAAG,IAAI,KAAK,MACrE,CACF,EAEAD,EACC,IAAMrB,EAAW,MAAM,KACvB,CAACuB,EAAQC,IAAW,CACftB,EAAW,OAASqB,GAAU,CAACC,IAEnCxB,EAAW,MAAM,WAChB,WAAWJ,EAAM,aAAa,uBAAuB,GACpD,WAAW2B,CAAM,EAAI,KACvBE,EAAmB,EACnB,CACF,EAEAJ,EACC,IAAMrB,EAAW,MAAM,WACtB0B,GAAW,CACXD,EAAmB,CACnB,CACF,EAEA,SAASA,GAAoB,CAC5BzB,EAAW,MAAM,MAChB,WAAWJ,EAAM,aAAa,uBAAuB,EACrD,WAAWI,EAAW,MAAM,UAAU,CACxC"}
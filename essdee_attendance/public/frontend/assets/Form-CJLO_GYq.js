import{b as C,c as V}from"./index-DY6of2et.js";import{i as A,a as S,c as w,O as u,w as k,j as i,y as d,n as p,l as b,q as s,a5 as E}from"./frappe-ui-DZDZpt4w.js";import R from"./FormView-YD0d5amj.js";import{g as j}from"./currencies-SJR35BQj.js";import"./FormField-7rSNy-En.js";import"./Link-WtJjedfJ.js";import"./FileUploaderView-LNKCLKYB.js";import"./WorkflowActionSheet-DCtdbUIp.js";import"./workflow-VIVVb1p-.js";import"./formatters-Ch330Bw1.js";const G={__name:"Form",props:{id:{type:String,required:!1}},setup(y){const r=A("$employee"),l=y,a=S({employee:r.data.name,employee_name:r.data.employee_name,company:r.data.company,department:r.data.department}),c=w(()=>j(a.value.company)),o=u({url:"essdee_attendance.api.get_doctype_fields",params:{doctype:"Employee Advance"},transform(e){const t=g(e);return h(t)},onSuccess(e){_.reload(),v.reload()}});o.reload();const _=u({url:"hrms.payroll.doctype.salary_structure_assignment.salary_structure_assignment.get_employee_currency",params:{employee:r.data.name},onSuccess(e){a.value.currency=e,m()}}),f=u({url:"erpnext.setup.utils.get_exchange_rate",onSuccess(e){a.value.exchange_rate=e}}),v=u({url:"essdee_attendance.api.get_advance_account",params:{company:a.value.company},onSuccess(e){a.value.advance_account=e}});k(()=>a.value.currency,()=>m());function g(e){const t=["naming_series"],n=["employee","employee_name","department","company","more_info_section","pending_amount"];return l.id||t.push(...n),e.filter(F=>!t.includes(F.fieldname))}function h(e){return e.map(t=>{if(t.fieldname==="advance_account"){let n=[a.value.currency];a.value.currency!=c.value&&n.push(c.value),t.linkFilters={company:a.value.company,is_group:0,root_type:"Asset",account_currency:n}}return t})}function m(){var t;if(!a.value.currency)return;const e=(t=o.data)==null?void 0:t.find(n=>n.fieldname==="exchange_rate");a.value.currency===c.value?(a.value.exchange_rate=1,e.hidden=1):(f.fetch({from_currency:a.value.currency,to_currency:c.value}),e.hidden=0)}function x(){}return(e,t)=>(i(),d(s(V),null,{default:p(()=>[b(s(C),{fullscreen:!0},{default:p(()=>[s(o).data?(i(),d(R,{key:0,doctype:"Employee Advance",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=n=>a.value=n),isSubmittable:!0,fields:s(o).data,id:l.id,showAttachmentView:!0,onValidateForm:x},null,8,["modelValue","fields","id"])):E("",!0)]),_:1})]),_:1}))}};export{G as default};
//# sourceMappingURL=Form-CJLO_GYq.js.map

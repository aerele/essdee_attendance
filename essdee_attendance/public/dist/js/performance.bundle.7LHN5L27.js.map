{
  "version": 3,
  "sources": ["../../../../../apps/essdee_attendance/essdee_attendance/public/js/performance/performance_feedback.js", "frappe-html:/home/anas/frappe-15/apps/essdee_attendance/essdee_attendance/public/js/templates/performance_feedback.html"],
  "sourcesContent": ["frappe.provide(\"hrms\");\n\nhrms.PerformanceFeedback = class PerformanceFeedback {\n\tconstructor({ frm, wrapper }) {\n\t\tthis.frm = frm;\n\t\tthis.wrapper = wrapper;\n\t}\n\n\trefresh() {\n\t\tthis.prepare_dom();\n\t\tthis.setup_feedback_view();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.find(\".feedback-section\").remove();\n\t}\n\n\tsetup_feedback_view() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.get_feedback_history(),\n\t\t\t(data) => this.render_feedback_history(data),\n\t\t\t() => this.setup_actions(),\n\t\t]);\n\t}\n\n\tget_feedback_history() {\n\t\tlet me = this;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe\n\t\t\t\t.call({\n\t\t\t\t\tmethod: \"hrms.hr.doctype.appraisal.appraisal.get_feedback_history\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\temployee: me.frm.doc.employee,\n\t\t\t\t\t\tappraisal: me.frm.doc.name,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((r) => resolve(r.message));\n\t\t});\n\t}\n\n\tasync render_feedback_history(data) {\n\t\tconst { feedback_history, reviews_per_rating, avg_feedback_score } = data || {};\n\t\tconst can_create = await this.can_create();\n\n\t\tconst feedback_html = frappe.render_template(\"performance_feedback\", {\n\t\t\tfeedback_history: feedback_history,\n\t\t\taverage_feedback_score: avg_feedback_score,\n\t\t\treviews_per_rating: reviews_per_rating,\n\t\t\tcan_create: can_create,\n\t\t});\n\n\t\t$(this.wrapper).empty();\n\t\t$(feedback_html).appendTo(this.wrapper);\n\t}\n\n\tsetup_actions() {\n\t\tlet me = this;\n\n\t\t$(\".new-feedback-btn\").click(() => {\n\t\t\tme.add_feedback();\n\t\t});\n\t}\n\n\tadd_feedback() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.get_feedback_criteria_data(),\n\t\t\t(criteria_data) => this.show_add_feedback_dialog(criteria_data),\n\t\t]);\n\t}\n\n\tget_feedback_criteria_data() {\n\t\tlet me = this;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe.db\n\t\t\t\t.get_doc(\"Appraisal Template\", me.frm.doc.appraisal_template)\n\t\t\t\t.then(({ rating_criteria }) => {\n\t\t\t\t\tconst criteria_list = [];\n\t\t\t\t\trating_criteria.forEach((entry) => {\n\t\t\t\t\t\tcriteria_list.push({\n\t\t\t\t\t\t\tcriteria: entry.criteria,\n\t\t\t\t\t\t\tper_weightage: entry.per_weightage,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tresolve(criteria_list);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tshow_add_feedback_dialog(criteria_data) {\n\t\tlet me = this;\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add Feedback\"),\n\t\t\tfields: me.get_feedback_dialog_fields(criteria_data),\n\t\t\tsize: \"large\",\n\t\t\tminimizable: true,\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t\tprimary_action: function () {\n\t\t\t\tconst data = dialog.get_values();\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"add_feedback\",\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfeedback: data.feedback,\n\t\t\t\t\t\tfeedback_ratings: data.feedback_ratings,\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.frm.refresh_fields(),\n\t\t\t\t\t\t\t\t() => me.refresh(),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Feedback {0} added successfully\", [\n\t\t\t\t\t\t\t\t\tr.message?.name?.bold(),\n\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tdialog.show();\n\t}\n\n\tget_feedback_dialog_fields(criteria_data) {\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: \"Feedback\",\n\t\t\t\tfieldname: \"feedback\",\n\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\treqd: 1,\n\t\t\t\tenable_mentions: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"Feedback Rating\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"feedback_ratings\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tdata: criteria_data,\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"criteria\",\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: \"Criteria\",\n\t\t\t\t\t\toptions: \"Employee Feedback Criteria\",\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"per_weightage\",\n\t\t\t\t\t\tfieldtype: \"Percent\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: \"Weightage\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"rating\",\n\t\t\t\t\t\tfieldtype: \"Rating\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: \"Rating\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\t}\n\n\tasync can_create() {\n\t\tconst is_employee =\n\t\t\t(await frappe.db.get_value(\"Employee\", { user_id: frappe.session.user }, \"name\"))\n\t\t\t\t?.message?.name || false;\n\n\t\treturn is_employee && frappe.model.can_create(\"Employee Performance Feedback\");\n\t}\n};\n", "\n\tfrappe.templates['performance_feedback'] = `<div class=\"feedback-section col-xs-12\">\n\t{% if (feedback_history.length) { %}\n\t\t<div class=\"feedback-summary mb-5 pb-2\">\n\t\t\t{%=\n\t\t\t\tfrappe.render_template(\n\t\t\t\t\t\"feedback_summary\",\n\t\t\t\t\t{\n\t\t\t\t\t\tnumber_of_stars: 5,\n\t\t\t\t\t\taverage_rating: average_feedback_score,\n\t\t\t\t\t\tfeedback_count: feedback_history.length,\n\t\t\t\t\t\treviews_per_rating: reviews_per_rating\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t%}\n\t\t</div>\n\t{% } %}\n\n\t{% if (can_create) { %}\n\t\t<div class=\"new-btn pb-3 text-right\">\n\t\t\t<button\n\t\t\t\tclass=\"new-feedback-btn btn btn-sm d-inline-flex align-items-center justify-content-center px-3 py-2 border\"\n\t\t\t>\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Feedback\") }}\n\t\t\t</button>\n\t\t</div>\n\t{% } %}\n\n\t{%=\n\t\tfrappe.render_template(\n\t\t\t\"feedback_history\",\n\t\t\t{ feedback_history: feedback_history, feedback_doctype: \"Employee Performance Feedback\" }\n\t\t)\n\t%}\n</div>\n`;\n"],
  "mappings": "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",
  "names": []
}
